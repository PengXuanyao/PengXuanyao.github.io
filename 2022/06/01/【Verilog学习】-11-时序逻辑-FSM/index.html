<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>【Verilog学习】-11-时序逻辑-FSM | Xuanyao's Blog</title><meta name="author" content="Xuanyao Peng"><meta name="copyright" content="Xuanyao Peng"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="标准的一些三段式有限状态机  Fsm1questionThis is a Moore state machine with two states, one input, and one output. Implement this state machine. Notice that the reset state is B. This exercise is the same as fsm1s">
<meta property="og:type" content="article">
<meta property="og:title" content="【Verilog学习】-11-时序逻辑-FSM">
<meta property="og:url" content="https://pengxuanyao.github.io/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/index.html">
<meta property="og:site_name" content="Xuanyao&#39;s Blog">
<meta property="og:description" content="标准的一些三段式有限状态机  Fsm1questionThis is a Moore state machine with two states, one input, and one output. Implement this state machine. Notice that the reset state is B. This exercise is the same as fsm1s">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/01/10/K5ZwIitHl2xDTVq.jpg">
<meta property="article:published_time" content="2022-06-01T11:42:12.000Z">
<meta property="article:modified_time" content="2023-01-11T04:16:35.810Z">
<meta property="article:author" content="Xuanyao Peng">
<meta property="article:tag" content="verilog">
<meta property="article:tag" content="FSM(有限状态机)">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/01/10/K5ZwIitHl2xDTVq.jpg"><link rel="shortcut icon" href="https://s2.loli.net/2023/01/10/ARwIOr2ym4q5kxY.png"><link rel="canonical" href="https://pengxuanyao.github.io/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '【Verilog学习】-11-时序逻辑-FSM',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-01-11 12:16:35'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2023/01/11/uxgHFMtiBm1kKcf.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">105</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://api.ixiaowai.cn/gqapi/gqapi.php/')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Xuanyao's Blog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">【Verilog学习】-11-时序逻辑-FSM</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-06-01T11:42:12.000Z" title="发表于 2022-06-01 19:42:12">2022-06-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-01-11T04:16:35.810Z" title="更新于 2023-01-11 12:16:35">2023-01-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0/">学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="【Verilog学习】-11-时序逻辑-FSM"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>标准的一些三段式有限状态机</p>
</blockquote>
<h2 id="Fsm1"><a href="#Fsm1" class="headerlink" title="Fsm1"></a>Fsm1</h2><h3 id="question"><a href="#question" class="headerlink" title="question"></a>question</h3><p>This is a Moore state machine with two states, one input, and one output. Implement this state machine. Notice that the reset state is B.</p>
<p>This exercise is the same as <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm1s">fsm1s</a>, but using asynchronous reset.</p>
<span id="more"></span>

<p><img src="https://hdlbits.01xz.net/mw/images/7/70/Fsm1.png" alt="Fsm1.png"></p>
<h3 id="Module-Declaration"><a href="#Module-Declaration" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module top_module(</span><br><span class="line">    input clk,</span><br><span class="line">    input areset,    // Asynchronous reset to state B</span><br><span class="line">    input in,</span><br><span class="line">    output out);</span><br></pre></td></tr></table></figure>

<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to state B</span></span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">output</span> out);<span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">1&#x27;b0</span>, B=<span class="number">1&#x27;b1</span>; </span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span>    <span class="comment">// This is a combinational always block</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A: next_state = in ? A : B;</span><br><span class="line">            B: next_state = in ? B : A;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span>    <span class="comment">// This is a sequential always block</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= B;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            state &lt;= next_state; </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> out = state ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm1s"><a href="#Fsm1s" class="headerlink" title="Fsm1s"></a>Fsm1s</h2><h3 id="question-1"><a href="#question-1" class="headerlink" title="question"></a>question</h3><p>This is a Moore state machine with two states, one input, and one output. Implement this state machine. Notice that the reset state is B.</p>
<p>This exercise is the same as <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm1">fsm1</a>, but using synchronous reset.</p>
<blockquote>
<p>这道题有点怪，为什么答案是用阻塞赋值</p>
</blockquote>
<h3 id="Module-Declaration-1"><a href="#Module-Declaration-1" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note the Verilog-1995 module declaration syntax here:</span></span><br><span class="line"><span class="keyword">module</span> top_module(clk, reset, in, out);</span><br><span class="line">    <span class="keyword">input</span> clk;</span><br><span class="line">    <span class="keyword">input</span> reset;    <span class="comment">// Synchronous reset to state B</span></span><br><span class="line">    <span class="keyword">input</span> in;</span><br><span class="line">    <span class="keyword">output</span> out;</span><br></pre></td></tr></table></figure>

<h3 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note the Verilog-1995 module declaration syntax here:</span></span><br><span class="line"><span class="keyword">module</span> top_module(clk, reset, in, out);</span><br><span class="line">    <span class="keyword">input</span> clk;</span><br><span class="line">    <span class="keyword">input</span> reset;    <span class="comment">// Synchronous reset to state B</span></span><br><span class="line">    <span class="keyword">input</span> in;</span><br><span class="line">    <span class="keyword">output</span> out;<span class="comment">//  </span></span><br><span class="line">    <span class="keyword">reg</span> out;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fill in state name declarations</span></span><br><span class="line">    <span class="keyword">parameter</span> A = <span class="number">1&#x27;b0</span>, B = <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">reg</span> present_state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span>  </span><br><span class="line">            <span class="comment">// Fill in reset logic</span></span><br><span class="line">            present_state = B;</span><br><span class="line">            out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (present_state)</span><br><span class="line">                <span class="comment">// Fill in state transition logic</span></span><br><span class="line">                A : next_state = in ? A : B;</span><br><span class="line">                B : next_state = in ? B : A;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// State flip-flops</span></span><br><span class="line">            present_state = next_state;   </span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> (present_state)</span><br><span class="line">                <span class="comment">// Fill in output logic</span></span><br><span class="line">                A : out = <span class="number">1&#x27;b0</span>;</span><br><span class="line">                B : out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm2"><a href="#Fsm2" class="headerlink" title="Fsm2"></a>Fsm2</h2><h3 id="question-2"><a href="#question-2" class="headerlink" title="question"></a>question</h3><p>This is a Moore state machine with two states, two inputs, and one output. Implement this state machine.</p>
<p>This exercise is the same as <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm2s">fsm2s</a>, but using asynchronous reset.</p>
<p><img src="https://hdlbits.01xz.net/mw/images/b/b8/Fsmjk.png" alt="Fsmjk.png"></p>
<h3 id="Module-Declaration-2"><a href="#Module-Declaration-2" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>

<h3 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> OFF=<span class="number">0</span>, ON=<span class="number">1</span>; </span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            OFF : next_state = j ? ON : OFF;</span><br><span class="line">            ON : next_state = k ? OFF : ON;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= OFF;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == ON);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm2s"><a href="#Fsm2s" class="headerlink" title="Fsm2s"></a>Fsm2s</h2><h3 id="question-3"><a href="#question-3" class="headerlink" title="question"></a>question</h3><p>This is a Moore state machine with two states, two inputs, and one output. Implement this state machine.</p>
<p>This exercise is the same as <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm2">fsm2</a>, but using synchronous reset.</p>
<img src="https://hdlbits.01xz.net/mw/images/5/5d/Fsmjks.png" alt="Fsmjks.png"  />

<h3 id="Module-Declaration-3"><a href="#Module-Declaration-3" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>

<h3 id="solution-1"><a href="#solution-1" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> OFF=<span class="number">0</span>, ON=<span class="number">1</span>; </span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            OFF : next_state = j ? ON : OFF;</span><br><span class="line">            ON : next_state = k ? OFF : ON;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= OFF;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == ON);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm3comb"><a href="#Fsm3comb" class="headerlink" title="Fsm3comb"></a>Fsm3comb</h2><h3 id="question-4"><a href="#question-4" class="headerlink" title="question"></a>question</h3><p>The following is the state transition table for a Moore state machine with one input, one output, and four states. Use the following state encoding: A&#x3D;2’b00, B&#x3D;2’b01, C&#x3D;2’b10, D&#x3D;2’b11.</p>
<p><strong>Implement only the state transition logic and output logic</strong> (the combinational logic portion) for this state machine. Given the current state (<code>state</code>), compute the <code>next_state</code> and output (<code>out</code>) based on the state transition table.</p>
<table>
<thead>
<tr>
<th align="left">State</th>
<th align="left">Next state</th>
<th align="left">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">in&#x3D;0</td>
<td align="left">in&#x3D;1</td>
<td></td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">A</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">A</td>
<td align="left">D</td>
<td>0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">B</td>
<td>1</td>
</tr>
</tbody></table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Module Declaration</span><br><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>

<h3 id="solution-2"><a href="#solution-2" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">0</span>, B=<span class="number">1</span>, C=<span class="number">2</span>, D=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic: next_state = f(state, in)</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A: next_state = in ? B : A;</span><br><span class="line">            B: next_state = in ? B : C;</span><br><span class="line">            C: next_state = in ? D : A;</span><br><span class="line">            D: next_state = in ? B : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic:  out = f(state) for a Moore state machine</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == D);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm3onehot"><a href="#Fsm3onehot" class="headerlink" title="Fsm3onehot"></a>Fsm3onehot</h2><h3 id="question-5"><a href="#question-5" class="headerlink" title="question"></a>question</h3><p>The following is the state transition table for a Moore state machine with one input, one output, and four states. Use the following one-hot state encoding: A&#x3D;4’b0001, B&#x3D;4’b0010, C&#x3D;4’b0100, D&#x3D;4’b1000.</p>
<p><strong>Derive state transition and output logic equations by inspection</strong> assuming a one-hot encoding. Implement only the state transition logic and output logic (the combinational logic portion) for this state machine. (The testbench will test with non-one hot inputs to make sure you’re not trying to do something more complicated).</p>
<table>
<thead>
<tr>
<th align="left">State</th>
<th align="left">Next state</th>
<th align="left">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">in&#x3D;0</td>
<td align="left">in&#x3D;1</td>
<td></td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">A</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">A</td>
<td align="left">D</td>
<td>0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">B</td>
<td>1</td>
</tr>
</tbody></table>
<blockquote>
<h4 id="What-does-“derive-equations-by-inspection”-mean"><a href="#What-does-“derive-equations-by-inspection”-mean" class="headerlink" title="What does “derive equations by inspection” mean?"></a>What does “derive equations by inspection” mean?</h4><p>One-hot state machine encoding guarantees that exactly one state bit is 1. This means that it is possible to determine whether the state machine is in a particular state by examining only <em>one</em> state bit, not <em>all</em> state bits. This leads to simple logic equations for the state transitions by examining the incoming edges for each state in the state transition diagram.</p>
<p>For example, in the above state machine, how can the state machine can reach state A? It must use one of the two incoming edges: “Currently in state A and in&#x3D;0” or “Currently in state C and in &#x3D; 0”. Due to the one-hot encoding, the logic equation to test for “currently in state A” is simply the state bit for state A. This leads to the final logic equation for the next state of state bit A: <code>next_state[0] = state[0]&amp;(~in) | state[2]&amp;(~in)</code>. The one-hot encoding guarantees that at most one clause (product term) will be “active” at a time, so the clauses can just be ORed together.</p>
<p>When an exercise asks for state transition equations “by inspection”, use this particular method. The judge will test with non-one-hot inputs to ensure your logic equations follow this method, rather that doing something else (such as resetting the FSM) for illegal (non-one-hot) combinations of the state bits.</p>
<p>Although knowing this algorithm isn’t necessary for RTL-level design (the logic synthesizer handles this), it is illustrative of why one-hot FSMs often have simpler logic (at the expense of more state bit storage), and this topic frequently shows up on exams in digital logic courses.</p>
</blockquote>
<h3 id="Module-Declaration-4"><a href="#Module-Declaration-4" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out);</span><br></pre></td></tr></table></figure>

<h3 id="solution-3"><a href="#solution-3" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">0</span>, B=<span class="number">1</span>, C=<span class="number">2</span>, D=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic: Derive an equation for each state flip-flop.</span></span><br><span class="line">    <span class="keyword">assign</span> next_state[A] = state[A]&amp;(~in) | state[C]&amp;(~in);</span><br><span class="line">    <span class="keyword">assign</span> next_state[B] = state[A]&amp;(in) | state[B]&amp;(in) | state[D]&amp;(in);</span><br><span class="line">    <span class="keyword">assign</span> next_state[C] = state[B]&amp;(~in) | state[D]&amp;(~in);</span><br><span class="line">    <span class="keyword">assign</span> next_state[D] = state[C]&amp;in;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic: </span></span><br><span class="line">    <span class="keyword">assign</span> out = state[D];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm3"><a href="#Fsm3" class="headerlink" title="Fsm3"></a>Fsm3</h2><h3 id="question-6"><a href="#question-6" class="headerlink" title="question"></a>question</h3><p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3comb">State transition logic for this FSM</a></p>
<p>The following is the state transition table for a Moore state machine with one input, one output, and four states. Implement this state machine. Include an asynchronous reset that resets the FSM to state A.</p>
<table>
<thead>
<tr>
<th align="left">State</th>
<th align="left">Next state</th>
<th align="left">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">in&#x3D;0</td>
<td align="left">in&#x3D;1</td>
<td></td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">A</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">A</td>
<td align="left">D</td>
<td>0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">B</td>
<td>1</td>
</tr>
</tbody></table>
<h3 id="Module-Declaration-5"><a href="#Module-Declaration-5" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>

<h3 id="question-7"><a href="#question-7" class="headerlink" title="question"></a>question</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm3-1"><a href="#Fsm3-1" class="headerlink" title="Fsm3"></a>Fsm3</h2><h3 id="question-8"><a href="#question-8" class="headerlink" title="question"></a>question</h3><p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3comb">State transition logic for this FSM</a></p>
<p>The following is the state transition table for a Moore state machine with one input, one output, and four states. Implement this state machine. Include an asynchronous reset that resets the FSM to state A.</p>
<table>
<thead>
<tr>
<th align="left">State</th>
<th align="left">Next state</th>
<th align="left">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">in&#x3D;0</td>
<td align="left">in&#x3D;1</td>
<td></td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">A</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">A</td>
<td align="left">D</td>
<td>0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">B</td>
<td>1</td>
</tr>
</tbody></table>
<h3 id="Module-Declaration-6"><a href="#Module-Declaration-6" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out);</span><br></pre></td></tr></table></figure>

<h3 id="solution-4"><a href="#solution-4" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] next_state;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">0</span>, B=<span class="number">1</span>, C=<span class="number">2</span>, D=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic: next_state = f(state, in)</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A: next_state = in ? B : A;</span><br><span class="line">            B: next_state = in ? B : C;</span><br><span class="line">            C: next_state = in ? D : A;</span><br><span class="line">            D: next_state = in ? B : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            state &lt;= next_state; </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic:  out = f(state) for a Moore state machine</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == D);</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* reference */</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">module top_module (</span></span><br><span class="line"><span class="comment">    input clk,</span></span><br><span class="line"><span class="comment">    input in,</span></span><br><span class="line"><span class="comment">    input areset,</span></span><br><span class="line"><span class="comment">    output out</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Give state names and assignments. I&#x27;m lazy, so I like to use decimal numbers.</span></span><br><span class="line"><span class="comment">    // It doesn&#x27;t really matter what assignment is used, as long as they&#x27;re unique.</span></span><br><span class="line"><span class="comment">    parameter A=0, B=1, C=2, D=3;</span></span><br><span class="line"><span class="comment">    reg [1:0] state;        // Make sure state and next are big enough to hold the state encodings.</span></span><br><span class="line"><span class="comment">    reg [1:0] next;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Combinational always block for state transition logic. Given the current state and inputs,</span></span><br><span class="line"><span class="comment">    // what should be next state be?</span></span><br><span class="line"><span class="comment">    // Combinational always block: Use blocking assignments.    </span></span><br><span class="line"><span class="comment">    always@(*) begin</span></span><br><span class="line"><span class="comment">        case (state)</span></span><br><span class="line"><span class="comment">            A: next = in ? B : A;</span></span><br><span class="line"><span class="comment">            B: next = in ? B : C;</span></span><br><span class="line"><span class="comment">            C: next = in ? D : A;</span></span><br><span class="line"><span class="comment">            D: next = in ? B : C;</span></span><br><span class="line"><span class="comment">        endcase</span></span><br><span class="line"><span class="comment">    end</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Edge-triggered always block (DFFs) for state flip-flops. Asynchronous reset.</span></span><br><span class="line"><span class="comment">    always @(posedge clk, posedge areset) begin</span></span><br><span class="line"><span class="comment">        if (areset) state &lt;= A;</span></span><br><span class="line"><span class="comment">        else state &lt;= next;</span></span><br><span class="line"><span class="comment">    end</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Combinational output logic. In this problem, an assign statement is the simplest.        </span></span><br><span class="line"><span class="comment">    assign out = (state==D);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">endmodule</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm3s"><a href="#Fsm3s" class="headerlink" title="Fsm3s"></a>Fsm3s</h2><h3 id="question-9"><a href="#question-9" class="headerlink" title="question"></a>question</h3><p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3comb">State transition logic for this FSM</a></p>
<p>The following is the state transition table for a Moore state machine with one input, one output, and four states. Implement this state machine. Include a synchronous reset that resets the FSM to state A. (This is the same problem as <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3">Fsm3</a> but with a synchronous reset.)</p>
<table>
<thead>
<tr>
<th align="left">State</th>
<th align="left">Next state</th>
<th align="left">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody><tr>
<td align="left"></td>
<td align="left">in&#x3D;0</td>
<td align="left">in&#x3D;1</td>
<td></td>
</tr>
<tr>
<td align="left">A</td>
<td align="left">A</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">B</td>
<td align="left">C</td>
<td align="left">B</td>
<td>0</td>
</tr>
<tr>
<td align="left">C</td>
<td align="left">A</td>
<td align="left">D</td>
<td>0</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">C</td>
<td align="left">B</td>
<td>1</td>
</tr>
</tbody></table>
<p><img src="https://hdlbits.01xz.net/mw/images/8/89/Fsm3.png" alt="Fsm3.png"></p>
<h3 id="Module-Declaration-7"><a href="#Module-Declaration-7" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>

<h3 id="solution-5"><a href="#solution-5" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line">    <span class="keyword">parameter</span> A = <span class="number">2&#x27;b00</span>, B = <span class="number">2&#x27;b01</span>, C = <span class="number">2&#x27;b10</span>, D = <span class="number">2&#x27;b11</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state) </span><br><span class="line">            A : next_state = in ? B : A;</span><br><span class="line">            B : next_state = in ? B : C;</span><br><span class="line">            C : next_state = in ? D : A;</span><br><span class="line">            D : next_state = in ? B : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// State flip-flops with synchronous reset</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : out = <span class="number">0</span>;</span><br><span class="line">            B : out = <span class="number">0</span>;</span><br><span class="line">            C : out = <span class="number">0</span>;</span><br><span class="line">            D : out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h3><p>开始设置state、next_state的位宽出现了问题：忘记写[1:0]。</p>
<h2 id="Exams-x2F-ece241-2013-q4"><a href="#Exams-x2F-ece241-2013-q4" class="headerlink" title="Exams&#x2F;ece241 2013 q4"></a>Exams&#x2F;ece241 2013 q4</h2><h3 id="question-10"><a href="#question-10" class="headerlink" title="question"></a>question</h3><p><img src="https://hdlbits.01xz.net/mw/thumb.php?f=Ece241_2013_q4.png&width=740" alt="Ece241 2013 q4.png"></p>
<p>Also include an active-high synchronous reset that resets the state machine to a state equivalent to if the water level had been low for a long time (no sensors asserted, and all four outputs asserted).</p>
<h3 id="Module-Declaration-8"><a href="#Module-Declaration-8" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] s,</span><br><span class="line">    <span class="keyword">output</span> fr3,</span><br><span class="line">    <span class="keyword">output</span> fr2,</span><br><span class="line">    <span class="keyword">output</span> fr1,</span><br><span class="line">    <span class="keyword">output</span> dfr</span><br><span class="line">); </span><br></pre></td></tr></table></figure>

<h3 id="solution-6"><a href="#solution-6" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] s,</span><br><span class="line">    <span class="keyword">output</span> fr3,</span><br><span class="line">    <span class="keyword">output</span> fr2,</span><br><span class="line">    <span class="keyword">output</span> fr1,</span><br><span class="line">    <span class="keyword">output</span> dfr</span><br><span class="line">); </span><br><span class="line">    <span class="keyword">parameter</span> IDLE = <span class="number">3&#x27;b001</span>, S1_UP = <span class="number">3&#x27;b010</span>, S1_DOWN = <span class="number">3&#x27;b011</span>, S2_UP = <span class="number">3&#x27;b100</span> , S2_DOWN = <span class="number">3&#x27;b101</span>, S3 = <span class="number">3&#x27;b110</span>; </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_UP;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_UP;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = IDLE; <span class="comment">/*开始出现bug是所有的这个位置没加default*/</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S1_UP: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_UP;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S1_UP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S1_DOWN: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_UP;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S1_DOWN;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S2_UP: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_DOWN;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S2_UP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S2_DOWN: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_DOWN;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S2_DOWN;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S3: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_DOWN;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_DOWN;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S3;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">default</span>: next_state = IDLE; <span class="comment">/*开始出现bug是所有case这个位置没加default*/</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            S1_UP: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0110</span>;</span><br><span class="line">            S1_DOWN: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0111</span>;</span><br><span class="line">            S2_UP: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">            S2_DOWN: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0011</span>;</span><br><span class="line">            S3: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">default</span>:  &#123;fr3, fr2, fr1, dfr&#125; = &#x27;x;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*reference solution*/</span></span><br><span class="line"><span class="comment">/*参考答案中，next_state的表达式是从状态发生顺序转变的角度考虑，每一个状态只能够转换到相临近的两个状态，上升或者下降*/</span></span><br><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] s,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> fr3,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> fr2,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> fr1,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> dfr</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Give state names and assignments. I&#x27;m lazy, so I like to use decimal numbers.</span></span><br><span class="line">    <span class="comment">// It doesn&#x27;t really matter what assignment is used, as long as they&#x27;re unique.</span></span><br><span class="line">    <span class="comment">// We have 6 states here.</span></span><br><span class="line">    <span class="keyword">parameter</span> A2=<span class="number">0</span>, B1=<span class="number">1</span>, B2=<span class="number">2</span>, C1=<span class="number">3</span>, C2=<span class="number">4</span>, D1=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next;        <span class="comment">// Make sure these are big enough to hold the state encodings.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Edge-triggered always block (DFFs) for state flip-flops. Synchronous reset.    </span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) state &lt;= A2;</span><br><span class="line">        <span class="keyword">else</span> state &lt;= next;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Combinational always block for state transition logic. Given the current state and inputs,</span></span><br><span class="line">    <span class="comment">// what should be next state be?</span></span><br><span class="line">    <span class="comment">// Combinational always block: Use blocking assignments.    </span></span><br><span class="line">    <span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A2: next = s[<span class="number">1</span>] ? B1 : A2;</span><br><span class="line">            B1: next = s[<span class="number">2</span>] ? C1 : (s[<span class="number">1</span>] ? B1 : A2);</span><br><span class="line">            B2: next = s[<span class="number">2</span>] ? C1 : (s[<span class="number">1</span>] ? B2 : A2);</span><br><span class="line">            C1: next = s[<span class="number">3</span>] ? D1 : (s[<span class="number">2</span>] ? C1 : B2);</span><br><span class="line">            C2: next = s[<span class="number">3</span>] ? D1 : (s[<span class="number">2</span>] ? C2 : B2);</span><br><span class="line">            D1: next = s[<span class="number">3</span>] ? D1 : C2;</span><br><span class="line">            <span class="keyword">default</span>: next = &#x27;x;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Combinational output logic. In this problem, a procedural block (combinational always block) </span></span><br><span class="line">    <span class="comment">// is more convenient. Be careful not to create a latch.</span></span><br><span class="line">    <span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A2: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            B1: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0110</span>;</span><br><span class="line">            B2: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0111</span>;</span><br><span class="line">            C1: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">            C2: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0011</span>;</span><br><span class="line">            D1: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">default</span>: &#123;fr3, fr2, fr1, dfr&#125; = &#x27;x;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="debug-1"><a href="#debug-1" class="headerlink" title="debug"></a>debug</h3><ul>
<li>注意case要考虑defualt的情况（特别时涉及的不确定输入有多个时，例如3位八种情况，其中3种有效，其他5种（default）也要考虑）</li>
</ul>
<h2 id="Lemmings1"><a href="#Lemmings1" class="headerlink" title="Lemmings1"></a>Lemmings1</h2><h3 id="question-11"><a href="#question-11" class="headerlink" title="question"></a>question</h3><p><img src="https://hdlbits.01xz.net/mw/images/d/de/Lemmings.gif" alt="File:Lemmings.gif"></p>
<p>The game <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Lemmings_(video_game)">Lemmings</a> involves critters with fairly simple brains. So simple that we are going to model it using a finite state machine.</p>
<p>In the Lemmings’ 2D world, Lemmings can be in one of two states: walking left or walking right. It will switch directions if it hits an obstacle. In particular, if a Lemming is bumped on the left, it will walk right. If it’s bumped on the right, it will walk left. If it’s bumped on both sides at the same time, it will still switch directions.</p>
<p>Implement a Moore state machine with two states, two inputs, and one output that models this behaviour.</p>
<p><img src="https://s2.loli.net/2022/06/10/NqhfVP6k8Mj7xB9.png" alt="waveform"></p>
<h3 id="Module-Declaration-9"><a href="#Module-Declaration-9" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right); </span><br></pre></td></tr></table></figure>

<h3 id="solution-7"><a href="#solution-7" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right); <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> LEFT=<span class="number">0</span>, RIGHT=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state) </span><br><span class="line">            LEFT : next_state = (bump_left) ? RIGHT : LEFT;</span><br><span class="line">            RIGHT : next_state = (bump_right) ? LEFT : RIGHT;</span><br><span class="line">            <span class="keyword">default</span> : next_state = LEFT;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset == <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= LEFT;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> walk_left = (state == LEFT);</span><br><span class="line">    <span class="keyword">assign</span> walk_right = (state == RIGHT);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Lemmings2"><a href="#Lemmings2" class="headerlink" title="Lemmings2"></a>Lemmings2</h2><h3 id="question-12"><a href="#question-12" class="headerlink" title="question"></a>question</h3><p><img src="https://hdlbits.01xz.net/mw/images/7/70/Lemmings2.gif" alt="Lemmings2.gif"></p>
<p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Lemmings1">Lemmings1</a>.</p>
<p>In addition to walking left and right, Lemmings will fall (and presumably go “aaah!”) if the ground disappears underneath them.</p>
<p>In addition to walking left and right and changing direction when bumped, when <code>ground=0</code>, the Lemming will fall and say “aaah!”. When the ground reappears (<code>ground=1</code>), the Lemming will resume walking in the same direction as before the fall. Being bumped while falling does not affect the walking direction, and being bumped in the same cycle as ground disappears (but not yet falling), or when the ground reappears while still falling, also does not affect the walking direction.</p>
<p>Build a finite state machine that models this behaviour.</p>
<p><img src="https://s2.loli.net/2022/06/10/R1vgx6LzZjTVMfA.png" alt="waveform"></p>
<h3 id="Module-Declaration-10"><a href="#Module-Declaration-10" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah ); </span><br></pre></td></tr></table></figure>

<h3 id="solution-8"><a href="#solution-8" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah ); </span><br><span class="line"></span><br><span class="line"><span class="keyword">parameter</span> LEFT = <span class="number">2&#x27;b00</span>, LEFT_FALL = <span class="number">2&#x27;b01</span>, RIGHT = <span class="number">2&#x27;b10</span>, RIGHT_FALL = <span class="number">2&#x27;b11</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"><span class="comment">// state transition</span></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line">    <span class="keyword">case</span> (state) </span><br><span class="line">        LEFT : next_state = (!ground) ? LEFT_FALL : (bump_left ? RIGHT : LEFT);</span><br><span class="line">        RIGHT : next_state = (!ground) ? RIGHT_FALL : (bump_right ? LEFT : RIGHT);</span><br><span class="line">        LEFT_FALL : next_state = ground ? LEFT : LEFT_FALL;</span><br><span class="line">        RIGHT_FALL : next_state = ground ? RIGHT : RIGHT_FALL;</span><br><span class="line">        <span class="keyword">default</span> : next_state = LEFT;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">    <span class="keyword">if</span> (areset == <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span></span><br><span class="line">        state &lt;= LEFT;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Output logic</span></span><br><span class="line"><span class="keyword">assign</span> walk_left = (state == LEFT);</span><br><span class="line"><span class="keyword">assign</span> walk_right = (state == RIGHT);</span><br><span class="line"><span class="keyword">assign</span> aaah = (state == LEFT_FALL) || (state == RIGHT_FALL);</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 又写了一遍</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Lemings 2</span></span><br><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah ); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> WL = <span class="number">2&#x27;b00</span>, WR = <span class="number">2&#x27;b01</span>, FL = <span class="number">2&#x27;b10</span>, FR = <span class="number">2&#x27;b11</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            WL : next_state = ground ? (bump_left ? WR : WL) : FL;</span><br><span class="line">            WR : next_state = ground ? (bump_right ? WL : WR) : FR;</span><br><span class="line">            FL : next_state = ground ? WL : FL;</span><br><span class="line">            FR : next_state = ground ? WR : FR;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> walk_left = (state == WL) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">assign</span> walk_right = (state == WR) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">assign</span> aaah = (state[<span class="number">1</span>]) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>; <span class="comment">// 这里使用的是定义state的时候，高位为1</span></span><br><span class="line">                                            <span class="comment">// 对应掉落的状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="debug-2"><a href="#debug-2" class="headerlink" title="debug"></a>debug</h3><ul>
<li><code>reg [1:0] state</code>开始写成了<code>reg state</code></li>
<li><code>parameter RIGHT_FALL = 2&#39;b11</code>开始写成了<code>parameter RIGHT_FALL = 2&#39;b10</code></li>
</ul>
<h2 id="Lemmings3"><a href="#Lemmings3" class="headerlink" title="Lemmings3"></a>Lemmings3</h2><h3 id="question-13"><a href="#question-13" class="headerlink" title="question:"></a>question:</h3><p><img src="https://hdlbits.01xz.net/mw/images/a/a2/Lemmings3.gif" alt="Thumbnail for version as of 23:13, 17 November 2015"></p>
<p>In addition to walking and falling, Lemmings can sometimes be told to do useful things, like dig (it starts digging when <code>dig=1</code>). A Lemming can dig if it is currently walking on ground (<code>ground=1</code> and not falling), and will continue digging until it reaches the other side (<code>ground=0</code>). At that point, since there is no ground, it will fall (aaah!), then continue walking in its original direction once it hits ground again. As with falling, being bumped while digging has no effect, and being told to dig when falling or when there is no ground is ignored.</p>
<p>(In other words, a walking Lemming can fall, dig, or switch directions. If more than one of these conditions are satisfied, fall has higher precedence than dig, which has higher precedence than switching directions.)</p>
<p>Extend your finite state machine to model this behaviour.</p>
<p><img src="https://s2.loli.net/2022/07/06/98CvhMdRqoSIp6F.png" alt="waveform"></p>
<h3 id="Module-Declaration-11"><a href="#Module-Declaration-11" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">input</span> dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging ); </span><br></pre></td></tr></table></figure>

<h3 id="solution-9"><a href="#solution-9" class="headerlink" title="solution"></a>solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Lemings 3</span></span><br><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">input</span> dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">localparam</span> WL = <span class="number">3&#x27;b000</span>, WR = <span class="number">3&#x27;b001</span>, FL = <span class="number">3&#x27;b010</span>, FR = <span class="number">3&#x27;b011</span>, DL = <span class="number">3&#x27;b100</span>, </span><br><span class="line">    DR = <span class="number">3&#x27;b101</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            WL : next_state = ground ? (dig ? DL : (bump_left ? WR : WL)) : FL;</span><br><span class="line">            WR : next_state = ground ? (dig ? DR : (bump_right ? WL : WR)) : FR;</span><br><span class="line">            FL : next_state = ground ? WL : FL;</span><br><span class="line">            FR : next_state = ground ? WR : FR;</span><br><span class="line">            DL : next_state = ground ? DL : FL;</span><br><span class="line">            DR : next_state = ground ? DR : FR;</span><br><span class="line">            <span class="keyword">default</span> : next_state = next_state;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> walk_left = (state == WL) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">assign</span> walk_right = (state == WR) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">assign</span> aaah = (state[<span class="number">1</span>]) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>; <span class="comment">// 这里使用定义state的时候，第2位为1</span></span><br><span class="line">                                            <span class="comment">// 对应掉落的状态</span></span><br><span class="line">    <span class="keyword">assign</span> digging = (state[<span class="number">2</span>]) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;  <span class="comment">// 这里使用定义state的时候，</span></span><br><span class="line">                                                <span class="comment">// 第3位为1，对应挖洞的状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span>  </span><br></pre></td></tr></table></figure>

<h2 id="Lemmings4"><a href="#Lemmings4" class="headerlink" title="Lemmings4"></a>Lemmings4</h2><p>Although Lemmings can walk, fall, and dig, Lemmings aren’t invulnerable. If a Lemming falls for too long then hits the ground, it can splatter. In particular, if a Lemming falls for more than 20 clock cycles then hits the ground, it will splatter and cease walking, falling, or digging (all 4 outputs become 0), forever (Or until the FSM gets reset). There is no upper limit on how far a Lemming can fall before hitting the ground. Lemmings only splatter when hitting the ground; they do not splatter in mid-air.</p>
<p><img src="https://hdlbits.01xz.net/mw/images/e/e8/Lemmings4.gif" alt="Lemings4"></p>
<p>Extend your finite state machine to model this behaviour.</p>
<p>Falling for 20 cycles is survivable:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220819111859.png" alt="waveform"></p>
<p>Falling for 21 cycles causes splatter:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220819111937.png" alt="waveform"></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">input</span> dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">localparam</span> WL = <span class="number">3&#x27;b000</span>, WR = <span class="number">3&#x27;b001</span>, FL = <span class="number">3&#x27;b010</span>, FR = <span class="number">3&#x27;b011</span>, DL = <span class="number">3&#x27;b100</span>, </span><br><span class="line">    DR = <span class="number">3&#x27;b101</span>, SP = <span class="number">3&#x27;b110</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">5</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> splat;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// counter</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> ((state == FL) || (state == FR)) <span class="keyword">begin</span></span><br><span class="line">                cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// splat</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            splat = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (cnt == <span class="number">6&#x27;d20</span>) <span class="keyword">begin</span></span><br><span class="line">                splat = <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                splat = splat;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// next_state</span></span><br><span class="line">    <span class="comment">// 注意要接触到地面才会爆炸，在空中是保持下落的状态。</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            WL : next_state = ground ? (dig ? DL : (bump_left ? WR : WL)) : FL;</span><br><span class="line">            WR : next_state = ground ? (dig ? DR : (bump_right ? WL : WR)) : FR;</span><br><span class="line">            FL : next_state = ground ? (splat ? SP : WL) : FL;</span><br><span class="line">            FR : next_state = ground ? (splat ? SP : WR) : FR;</span><br><span class="line">            DL : next_state = ground ? DL : FL;</span><br><span class="line">            DR : next_state = ground ? DR : FR;</span><br><span class="line">            SP : next_state = state;</span><br><span class="line">            <span class="keyword">default</span> : next_state = next_state;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// state convert</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">assign</span> walk_left = ((state == WL) &amp;&amp; (state != SP)) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">assign</span> walk_right = ((state == WR) &amp;&amp; (state != SP)) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">assign</span> aaah = ((state == FL || state == FR) &amp;&amp; (state != SP)) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>; </span><br><span class="line">                                            <span class="comment">// 这里使用定义state的时候，第2位为1</span></span><br><span class="line">                                            <span class="comment">// 对应掉落的状态</span></span><br><span class="line">    <span class="keyword">assign</span> digging = ((state == DL || state == DR) &amp;&amp; (state != SP)) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;  </span><br><span class="line">                                            <span class="comment">// 这里使用定义state的时候，</span></span><br><span class="line">                                            <span class="comment">// 第3位为1，对应挖洞的状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h3><p>debug历程如下：</p>
<ol>
<li>最主要的bug：cnt计数比较值应该是20，而不是21。我想的是要记数到21，但忘了0开始计数的话，到20就是第21个。</li>
<li>其次，写next_state的表达式的时候，忘记了FL&#x2F;FR到SP是要碰到地上才行，因此是要先判断ground，再判断splat信号。</li>
</ol>
<h2 id="Fsm-onehot"><a href="#Fsm-onehot" class="headerlink" title="Fsm onehot"></a>Fsm onehot</h2><h3 id="question-14"><a href="#question-14" class="headerlink" title="question"></a>question</h3><p>Given the following state machine with 1 input and 2 outputs:</p>
<p><a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/File:Fsmonehot.png"><img src="https://hdlbits.01xz.net/mw/images/a/a7/Fsmonehot.png" alt="Fsmonehot.png"></a></p>
<p>Suppose this state machine uses one-hot encoding, where <code>state[0]</code> through <code>state[9]</code> correspond to the states S0 though S9, respectively. The outputs are zero unless otherwise specified.</p>
<p>Implement the <strong>state transition logic</strong> and <strong>output logic</strong> portions of the state machine (but not the state flip-flops). You are given the current state in <code>state[9:0]</code> and must produce <code>next_state[9:0]</code> and the two outputs. Derive the logic equations by inspection assuming a one-hot encoding. (The testbench will test with non-one hot inputs to make sure you’re not trying to do something more complicated).</p>
<h3 id="Module-Declaration-12"><a href="#Module-Declaration-12" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out1,</span><br><span class="line">    <span class="keyword">output</span> out2);</span><br></pre></td></tr></table></figure>

<h3 id="Write-your-solution-here"><a href="#Write-your-solution-here" class="headerlink" title="Write your solution here"></a>Write your solution here</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out1,</span><br><span class="line">    <span class="keyword">output</span> out2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    next_state[<span class="number">0</span>] = (~in &amp; (state[<span class="number">0</span>] | state[<span class="number">1</span>] | state[<span class="number">2</span>] | state[<span class="number">3</span>] | state[<span class="number">4</span>]</span><br><span class="line">     | state[<span class="number">7</span>] | state[<span class="number">8</span>] | state[<span class="number">9</span>]));</span><br><span class="line">    next_state[<span class="number">1</span>] = (in &amp; (state[<span class="number">0</span>] | state[<span class="number">8</span>] | state[<span class="number">9</span>]));</span><br><span class="line">    next_state[<span class="number">2</span>] = (in &amp; state[<span class="number">1</span>]);</span><br><span class="line">    next_state[<span class="number">3</span>] = (in &amp; state[<span class="number">2</span>]);</span><br><span class="line">    next_state[<span class="number">4</span>] = (in &amp; state[<span class="number">3</span>]);</span><br><span class="line">    next_state[<span class="number">5</span>] = (in &amp; state[<span class="number">4</span>]);</span><br><span class="line">    next_state[<span class="number">6</span>] = (in &amp; state[<span class="number">5</span>]);</span><br><span class="line">    next_state[<span class="number">7</span>] = (in &amp; (state[<span class="number">7</span>] | state[<span class="number">6</span>]));</span><br><span class="line">    next_state[<span class="number">8</span>] = (~in &amp; state[<span class="number">5</span>]);</span><br><span class="line">    next_state[<span class="number">9</span>] = (~in &amp; state[<span class="number">6</span>]);</span><br><span class="line">    out1 = (state[<span class="number">8</span>] | state[<span class="number">9</span>]);</span><br><span class="line">    out2 = (state[<span class="number">9</span>] | state[<span class="number">7</span>]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="debug-3"><a href="#debug-3" class="headerlink" title="debug"></a>debug</h3><p>这一道题的本意是用独热码的原理进行状态转移，因此如果直接定有状态机进行状态转移，测试会报错。因此，应当选择独热码的转移形式。</p>
<h2 id="Fsm-ps2"><a href="#Fsm-ps2" class="headerlink" title="Fsm ps2"></a>Fsm ps2</h2><h3 id="question-15"><a href="#question-15" class="headerlink" title="question"></a>question</h3><p>The PS&#x2F;2 mouse protocol sends messages that are three bytes long. However, within a continuous byte stream, it’s not obvious where messages start and end. The only indication is that the first byte of each three byte message always has bit[3]&#x3D;1 (but bit[3] of the other two bytes may be 1 or 0 depending on data).</p>
<p>We want a finite state machine that will search for message boundaries when given an input byte stream. The algorithm we’ll use is to discard bytes until we see one with bit[3]&#x3D;1. We then assume that this is byte 1 of a message, and signal the receipt of a message once all 3 bytes have been received (done).</p>
<p>The FSM should signal done in the cycle immediately after the third byte of each message was successfully received.</p>
<h3 id="Some-timing-diagrams-to-explain-the-desired-behaviour"><a href="#Some-timing-diagrams-to-explain-the-desired-behaviour" class="headerlink" title="Some timing diagrams to explain the desired behaviour"></a>Some timing diagrams to explain the desired behaviour</h3><p>Under error-free conditions, every three bytes form a message:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220820152622.png" alt="error-free"></p>
<p>When an error occurs, search for byte 1:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220820153313.png" alt="error"></p>
<p>Note that this is not the same as a 1xx sequence recognizer. Overlapping sequences are not allowed here:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220820153338.png" alt="notion"></p>
<h3 id="Module-Declaration-13"><a href="#Module-Declaration-13" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> done);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><h4 id="状态转移图"><a href="#状态转移图" class="headerlink" title="状态转移图"></a>状态转移图</h4><p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/%E7%8A%B6%E6%80%81%E5%9B%BE.drawio.png" alt="state_transfer_diagram"></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> done); <span class="comment">//</span></span><br><span class="line">	</span><br><span class="line">    <span class="keyword">localparam</span> BYTE1 = <span class="number">2&#x27;b00</span>, BYTE2 = <span class="number">2&#x27;b01</span>, BYTE3 = <span class="number">2&#x27;b10</span>, DONE = <span class="number">2&#x27;b11</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] current_state, next_state;</span><br><span class="line">    <span class="comment">// State transition logic (combinational)</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (current_state)</span><br><span class="line">            BYTE1 : next_state = in[<span class="number">3</span>] ? BYTE2 : BYTE1;</span><br><span class="line">            BYTE2 : next_state = BYTE3;</span><br><span class="line">            BYTE3 : next_state = DONE;</span><br><span class="line">            DONE : next_state = in[<span class="number">3</span>] ? BYTE2 : BYTE1; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// State flip-flops (sequential)</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            current_state &lt;= BYTE1;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> current_state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> done = (current_state == DONE) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="Fsm-ps2data"><a href="#Fsm-ps2data" class="headerlink" title="Fsm ps2data"></a>Fsm ps2data</h2><h4 id="question-16"><a href="#question-16" class="headerlink" title="question"></a>question</h4><p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm_ps2" title="Fsm ps2">PS&#x2F;2 packet parser</a>.</p>
<p>Now that you have a state machine that will identify three-byte messages in a PS&#x2F;2 byte stream, add a datapath that will also output the 24-bit (3 byte) message whenever a packet is received (out_bytes[23:16] is the first byte, out_bytes[15:8] is the second byte, etc.).</p>
<p>out_bytes needs to be valid whenever the done signal is asserted. You may output anything at other times (i.e., don’t-care).</p>
<p>For example:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220820153817.png" alt="waveform"></p>
<h3 id="Module-Declaration-14"><a href="#Module-Declaration-14" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">23</span>:<span class="number">0</span>] out_bytes,</span><br><span class="line">    <span class="keyword">output</span> done);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">23</span>:<span class="number">0</span>] out_bytes,</span><br><span class="line">    <span class="keyword">output</span> done);</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">localparam</span> BYTE1 = <span class="number">2&#x27;b00</span>, BYTE2 = <span class="number">2&#x27;b01</span>, BYTE3 = <span class="number">2&#x27;b10</span>, DONE = <span class="number">2&#x27;b11</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] current_state, next_state;</span><br><span class="line">    <span class="comment">// State transition logic (combinational)</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (current_state)</span><br><span class="line">            BYTE1 : next_state = in[<span class="number">3</span>] ? BYTE2 : BYTE1;</span><br><span class="line">            BYTE2 : next_state = BYTE3;</span><br><span class="line">            BYTE3 : next_state = DONE;</span><br><span class="line">            DONE : next_state = in[<span class="number">3</span>] ? BYTE2 : BYTE1; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// State flip-flops (sequential)</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            current_state &lt;= BYTE1;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> current_state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> done = (current_state == DONE) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Datapath to store incoming bytes</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (current_state == BYTE2) out_bytes[<span class="number">15</span>:<span class="number">8</span>] &lt;= in;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (current_state == BYTE3) out_bytes[<span class="number">7</span>:<span class="number">0</span>] &lt;= in;</span><br><span class="line">        <span class="keyword">else</span> out_bytes[<span class="number">23</span>:<span class="number">16</span>] &lt;= in;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-1"><a href="#Debug-1" class="headerlink" title="Debug"></a>Debug</h3><p>最开始的数据通路写错了，没有考虑到Done有时候是对应于第一个字节：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Datapath to store incoming bytes</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (current_state == BYTE1) out_bytes[<span class="number">23</span>:<span class="number">16</span>] &lt;= in;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current_state == BYTE2) out_bytes[<span class="number">15</span>:<span class="number">8</span>] &lt;= in;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current_state == BYTE3) out_bytes[<span class="number">7</span>:<span class="number">0</span>] &lt;= in;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>改过之后：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Datapath to store incoming bytes</span></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (current_state == BYTE2) out_bytes[<span class="number">15</span>:<span class="number">8</span>] &lt;= in;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (current_state == BYTE3) out_bytes[<span class="number">7</span>:<span class="number">0</span>] &lt;= in;</span><br><span class="line">    <span class="keyword">else</span> out_bytes[<span class="number">23</span>:<span class="number">16</span>] &lt;= in;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm-serial"><a href="#Fsm-serial" class="headerlink" title="Fsm serial"></a>Fsm serial</h2><h3 id="question-17"><a href="#question-17" class="headerlink" title="question"></a>question</h3><p>In many (older) serial communications protocols, each data byte is sent along with a start bit and a stop bit, to help the receiver delimit bytes from the stream of bits. One common scheme is to use one start bit (0), 8 data bits, and 1 stop bit (1). The line is also at logic 1 when nothing is being transmitted (idle).</p>
<p>Design a finite state machine that will identify when bytes have been correctly received when given a stream of bits. It needs to identify the start bit, wait for all 8 data bits, then verify that the stop bit was correct. If the stop bit does not appear when expected, the FSM must wait until it finds a stop bit before attempting to receive the next byte.</p>
<h3 id="Some-timing-diagrams"><a href="#Some-timing-diagrams" class="headerlink" title="Some timing diagrams"></a>Some timing diagrams</h3><p>Error-free:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220820155545.png" alt="error-free"></p>
<p>Stop bit not found. First byte is discarded:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220820155617.png" alt="error"></p>
<h3 id="Module-Declaration-15"><a href="#Module-Declaration-15" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> done</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> done); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> IDLE = <span class="number">3&#x27;b000</span>, START = <span class="number">3&#x27;b001</span>, TRANS = <span class="number">3&#x27;b010</span>, STOP = <span class="number">3&#x27;b011</span>,</span><br><span class="line">    ERROR = <span class="number">3&#x27;b100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// counter</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (state == TRANS) cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">else</span> cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// next_state</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span> </span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE : next_state = in ? IDLE : START;</span><br><span class="line">            START: next_state = TRANS; </span><br><span class="line">            TRANS: next_state = (cnt == <span class="number">4&#x27;d7</span>) ? (in ? STOP : ERROR) : TRANS;</span><br><span class="line">            STOP:  next_state = in ? IDLE : START;</span><br><span class="line">            ERROR: next_state = in ? IDLE : ERROR;</span><br><span class="line">            <span class="keyword">default</span>: next_state = IDLE; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// state transition</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">assign</span> done = (state == STOP) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-2"><a href="#Debug-2" class="headerlink" title="Debug"></a>Debug</h3><ol>
<li><p>注意题目说如果出错要一直停在错误的状态ERROR，只有当输入重新变成1后，才能进入IDLE。</p>
</li>
<li><p>cnt的计数界限要注意以下，这里用了state而不是next_state作为判断，因此，再计数的时候是到4’d7（第八个）就停下来了，而没有等到4‘d8（第九个）。</p>
<p>   或者直接:</p>
</li>
</ol>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// counter</span></span><br><span class="line"> <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">         cnt &lt;= <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line">     <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">         <span class="comment">// 原来这里用的state</span></span><br><span class="line">         <span class="keyword">if</span> (next_state == TRANS) cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">         <span class="keyword">else</span> cnt &lt;= <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"> <span class="keyword">end</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">省略代码</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span> </span><br><span class="line">     <span class="keyword">case</span> (state)</span><br><span class="line">         IDLE : next_state = in ? IDLE : START;</span><br><span class="line">         START: next_state = TRANS; </span><br><span class="line">         <span class="comment">// 这里变成第九个</span></span><br><span class="line">         TRANS: next_state = (cnt == <span class="number">4&#x27;d8</span>) ? (in ? STOP : ERROR) : TRANS;</span><br><span class="line">         STOP:  next_state = in ? IDLE : START;</span><br><span class="line">         ERROR: next_state = in ? IDLE : ERROR;</span><br><span class="line">         <span class="keyword">default</span>: next_state = IDLE; </span><br><span class="line">     <span class="keyword">endcase</span></span><br><span class="line"> <span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm-serialdata"><a href="#Fsm-serialdata" class="headerlink" title="Fsm serialdata"></a>Fsm serialdata</h2><h3 id="Qusetion"><a href="#Qusetion" class="headerlink" title="Qusetion"></a>Qusetion</h3><p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm_serial" title="Fsm serial">Serial receiver</a></p>
<p>Now that you have a finite state machine that can identify when bytes are correctly received in a serial bitstream, add a datapath that will output the correctly-received data byte. out_byte needs to be valid when done is 1, and is don’t-care otherwise.</p>
<p>Note that the serial protocol sends the <em>least</em> significant bit first</p>
<h3 id="Some-timing-diagrams-1"><a href="#Some-timing-diagrams-1" class="headerlink" title="Some timing diagrams"></a>Some timing diagrams</h3><p><img src="https://i.niupic.com/images/2022/08/20/a2bF.png" alt="waveform"></p>
<h3 id="Module-Declaration-16"><a href="#Module-Declaration-16" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] out_byte,</span><br><span class="line">    <span class="keyword">output</span> done</span><br><span class="line">);</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h3 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution"></a>Solution</h3><p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/F184A50CB7398BA21DE27178DB51C6F4.png" alt="state_machine"></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] out_byte,</span><br><span class="line">    <span class="keyword">output</span> done); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> IDLE = <span class="number">3&#x27;b000</span>, START = <span class="number">3&#x27;b001</span>, TRANS = <span class="number">3&#x27;b010</span>, STOP = <span class="number">3&#x27;b011</span>,</span><br><span class="line">    ERROR = <span class="number">3&#x27;b100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cnt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// counter</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (state == TRANS) cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">else</span> cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// next_state</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span> </span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE : next_state = in ? IDLE : START;</span><br><span class="line">            START: next_state = TRANS; </span><br><span class="line">            TRANS: next_state = (cnt == <span class="number">4&#x27;d7</span>) ? (in ? STOP : ERROR) : TRANS;</span><br><span class="line">            STOP:  next_state = in ? IDLE : START;</span><br><span class="line">            ERROR: next_state = in ? IDLE : ERROR;</span><br><span class="line">            <span class="keyword">default</span>: next_state = IDLE; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// state transition</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">assign</span> done = (state == STOP) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// datapath</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (next_state == TRANS) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">integer</span> i;</span><br><span class="line">            out_byte[<span class="number">7</span>] &lt;= in;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : datapath_loop</span><br><span class="line">                out_byte[i] &lt;= out_byte[i + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Fsm-serialdp"><a href="#Fsm-serialdp" class="headerlink" title="Fsm serialdp"></a>Fsm serialdp</h2><h3 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h3><p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm_serialdata" title="fsm_serialdata">Serial receiver and datapath</a></p>
<p>We want to add parity checking to the serial receiver. Parity checking adds one extra bit after each data byte. We will use odd parity, where the number of 1s in the 9 bits received must be odd. For example, 101001011 satisfies odd parity (there are 5 1s), but 001001011 does not.</p>
<p>Change your FSM and datapath to perform odd parity checking. Assert the done signal only if a byte is correctly received <em>and</em> its parity check passes. Like the <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm_serial" title="fsm_serial">serial receiver FSM</a>, this FSM needs to identify the start bit, wait for all 9 (data and parity) bits, then verify that the stop bit was correct. If the stop bit does not appear when expected, the FSM must wait until it finds a stop bit before attempting to receive the next byte.</p>
<p>You are provided with the following module that can be used to calculate the parity of the input stream (It’s a TFF with reset). The intended use is that it should be given the input bit stream, and reset at appropriate times so it counts the number of 1 bits in each byte.</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">module</span> parity (</span><br><span class="line">        <span class="keyword">input</span> clk,</span><br><span class="line">        <span class="keyword">input</span> reset,</span><br><span class="line">        <span class="keyword">input</span> in,</span><br><span class="line">        <span class="keyword">output</span> <span class="keyword">reg</span> odd);</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)</span><br><span class="line">            <span class="keyword">if</span> (reset) odd &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (in) odd &lt;= ~odd;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">endmodule</span></span><br><span class="line">    </span><br><span class="line">Note that the serial protocol sends the least significant <span class="keyword">bit</span> first, <span class="keyword">and</span> the parity <span class="keyword">bit</span> after the <span class="number">8</span> data bits.</span><br></pre></td></tr></table></figure>

<h3 id="Some-timing-diagrams-2"><a href="#Some-timing-diagrams-2" class="headerlink" title="Some timing diagrams"></a>Some timing diagrams</h3><p>No framing errors. Odd parity passes for first byte, fails for second byte.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220821112338.png" alt="wavrform"></p>
<p>—</p>
<h3 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h3><p>好端端的又上传不了图片，恢复步骤：</p>
<ol>
<li><p>开始报错信息是连不上网，可能是使用github作为图床，连接不太稳定的原因。解决办法如下：</p>
<ol>
<li>用ClashforWindows设置代理，使用其默认的端口号7890.</li>
<li>在picgo中设置代理：<br> <img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220821112810.png" alt="设置代理"></li>
</ol>
<p> <img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220821112858.png" alt="使用默认端口号"></p>
</li>
<li><p>后来又出现问题说认证出了问题（401），后通过重新设置token并使用新的token解决。</p>
</li>
</ol>
<h3 id="Module-Declaration-17"><a href="#Module-Declaration-17" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] out_byte,</span><br><span class="line">    <span class="keyword">output</span> done</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution"></a>Solution</h3><p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/CFA68D12AFEAD188430428508AD5189A.png" alt="state_machine" title="state_machine"></p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] out_byte,</span><br><span class="line">    <span class="keyword">output</span> done); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> IDLE = <span class="number">3&#x27;b000</span>, START = <span class="number">3&#x27;b001</span>, TRANS = <span class="number">3&#x27;b010</span>, STOP = <span class="number">3&#x27;b011</span>,</span><br><span class="line">    ERROR = <span class="number">3&#x27;b100</span>, PARITY = <span class="number">3&#x27;b101</span>, ABSORT = <span class="number">3&#x27;b110</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">wire</span> parity_flag, parity_reset;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// counter</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (next_state == TRANS) cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">else</span> cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// next_state</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span> </span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE    : next_state = in ? IDLE : START;</span><br><span class="line">            START   : next_state = TRANS; </span><br><span class="line">            TRANS   : next_state = (cnt == <span class="number">4&#x27;d8</span>) ? PARITY : TRANS;</span><br><span class="line">            PARITY  : next_state = in ? ((parity_flag) ? STOP : ABSORT) : ERROR;</span><br><span class="line">            STOP    : next_state = in ? IDLE : START;</span><br><span class="line">            ERROR   : next_state = in ? IDLE : ERROR;</span><br><span class="line">            ABSORT  : next_state = in ? IDLE : START;</span><br><span class="line">            <span class="keyword">default</span> : next_state = IDLE; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// state transition</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// output</span></span><br><span class="line">    <span class="keyword">assign</span> done = (state == STOP) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// datapath</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (next_state == TRANS) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">integer</span> i;</span><br><span class="line">            out_byte[<span class="number">7</span>] &lt;= in;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : datapath_loop</span><br><span class="line">                out_byte[i] &lt;= out_byte[i + <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// parity_reset</span></span><br><span class="line">    <span class="keyword">assign</span> parity_reset = (next_state == START) | reset;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// parity</span></span><br><span class="line">    parity parity_ins(<span class="variable">.clk</span>(clk), <span class="variable">.reset</span>(parity_reset), <span class="variable">.in</span>(in), <span class="variable">.odd</span>(parity_flag));</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-3"><a href="#Debug-3" class="headerlink" title="Debug"></a>Debug</h3><p>时序老是出问题，还是状态寄存器next_state和state之间的关系没弄透彻。最后通过一番瞎试出了结果(<code>TRANS   : next_state = (cnt == 4&#39;d8) ? PARITY : TRANS;</code>里面的<code>cnt == 4&#39;d8</code>是由<code>cnt == 4&#39;d7</code>改过来的)</p>
<h2 id="Fsm-hdlc"><a href="#Fsm-hdlc" class="headerlink" title="Fsm hdlc"></a>Fsm hdlc</h2><h3 id="Question-1"><a href="#Question-1" class="headerlink" title="Question"></a>Question</h3><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/High-Level_Data_Link_Control#Synchronous_framing">Synchronous HDLC framing</a> involves decoding a continuous bit stream of data to look for bit patterns that indicate the beginning and end of frames (packets). Seeing exactly 6 consecutive 1s (i.e., 01111110) is a “flag” that indicate frame boundaries. To avoid the data stream from accidentally containing “flags”, the sender inserts a zero after every 5 consecutive 1s which the receiver must detect and discard. We also need to signal an error if there are 7 or more consecutive 1s.</p>
<p>Create a finite state machine to recognize these three sequences:</p>
<ul>
<li>0111110: Signal a bit needs to be discarded (disc).</li>
<li>01111110: Flag the beginning&#x2F;end of a frame (flag).</li>
<li>01111111…: Error (7 or more 1s) (err).</li>
</ul>
<p>When the FSM is reset, it should be in a state that behaves as though the previous input were 0.</p>
<p>Here are some example sequences that illustrate the desired operation.</p>
<p>Discard 0111110:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822092935.png" alt="wf1"></p>
<p>Flag 01111110:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822092959.png" alt="wf2"></p>
<p>Reset behaviour and error 01111111…:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822093022.png" alt="wf3"></p>
<h3 id="Module-Declaration-18"><a href="#Module-Declaration-18" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">output</span> disc,</span><br><span class="line">    <span class="keyword">output</span> flag,</span><br><span class="line">    <span class="keyword">output</span> err);</span><br></pre></td></tr></table></figure>

<h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h3><p>Use a Moore state machine with around 10 states.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822093157.png" alt="state_machine"></p>
<h3 id="Solution-6"><a href="#Solution-6" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">output</span> disc,</span><br><span class="line">    <span class="keyword">output</span> flag,</span><br><span class="line">    <span class="keyword">output</span> err);</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] next_state, state;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        next_state[<span class="number">0</span>] = (~in &amp; (state[<span class="number">0</span>] | state[<span class="number">1</span>] | state[<span class="number">2</span>] | state[<span class="number">3</span>] | state[<span class="number">4</span>]</span><br><span class="line">         | state[<span class="number">7</span>] | state[<span class="number">8</span>] | state[<span class="number">9</span>]));</span><br><span class="line">        next_state[<span class="number">1</span>] = (in &amp; (state[<span class="number">0</span>] | state[<span class="number">8</span>] | state[<span class="number">9</span>]));</span><br><span class="line">        next_state[<span class="number">2</span>] = (in &amp; state[<span class="number">1</span>]);</span><br><span class="line">        next_state[<span class="number">3</span>] = (in &amp; state[<span class="number">2</span>]);</span><br><span class="line">        next_state[<span class="number">4</span>] = (in &amp; state[<span class="number">3</span>]);</span><br><span class="line">        next_state[<span class="number">5</span>] = (in &amp; state[<span class="number">4</span>]);</span><br><span class="line">        next_state[<span class="number">6</span>] = (in &amp; state[<span class="number">5</span>]);</span><br><span class="line">        next_state[<span class="number">7</span>] = (in &amp; (state[<span class="number">7</span>] | state[<span class="number">6</span>]));</span><br><span class="line">        next_state[<span class="number">8</span>] = (~in &amp; state[<span class="number">5</span>]);</span><br><span class="line">        next_state[<span class="number">9</span>] = (~in &amp; state[<span class="number">6</span>]);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) </span><br><span class="line">            state &lt;= <span class="number">10&#x27;b1</span>;  <span class="comment">// 注意：这里复位不是0，要根据独热码的规则。</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> err = state[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">assign</span> disc = state[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">assign</span> flag = state[<span class="number">9</span>];</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-4"><a href="#Debug-4" class="headerlink" title="Debug"></a>Debug</h3><p>注意：复位状态时10’b1，这里用了上面独热码题目（onehot）的代码。</p>
<h2 id="Exams-x2F-ece241-2013-q8"><a href="#Exams-x2F-ece241-2013-q8" class="headerlink" title="Exams&#x2F;ece241 2013 q8"></a>Exams&#x2F;ece241 2013 q8</h2><h3 id="Question-2"><a href="#Question-2" class="headerlink" title="Question"></a>Question</h3><p>Implement a <strong>Mealy</strong>-type finite state machine that recognizes the sequence “101” on an input signal named <strong>x</strong>. Your FSM should have an output signal, <strong>z</strong>, that is asserted to logic-1 when the “101” sequence is detected. Your FSM should also have an active-low asynchronous reset. You may only have 3 states in your state machine. Your FSM should recognize overlapping sequences.</p>
<h3 id="Module-Declaration-19"><a href="#Module-Declaration-19" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> aresetn,    <span class="comment">// Asynchronous active-low reset</span></span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z );</span><br></pre></td></tr></table></figure>

<h3 id="Solution-7"><a href="#Solution-7" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> aresetn,    <span class="comment">// Asynchronous active-low reset</span></span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z ); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> IDLE = <span class="number">2&#x27;b00</span>, ONE = <span class="number">2&#x27;b01</span>, TEN = <span class="number">2&#x27;b10</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE : next_state = x ? ONE : IDLE;</span><br><span class="line">            ONE : next_state = x ? ONE : TEN;</span><br><span class="line">            TEN : next_state = x ? ONE : IDLE;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> aresetn) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~aresetn) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> z = (state == TEN) &amp; (x == <span class="number">1&#x27;b1</span>);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Referrence"><a href="#Referrence" class="headerlink" title="Referrence"></a>Referrence</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">	<span class="keyword">input</span> clk,</span><br><span class="line">	<span class="keyword">input</span> aresetn,</span><br><span class="line">	<span class="keyword">input</span> x,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">reg</span> z</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Give state names and assignments. I&#x27;m lazy, so I like to use decimal numbers.</span></span><br><span class="line">	<span class="comment">// It doesn&#x27;t really matter what assignment is used, as long as they&#x27;re unique.</span></span><br><span class="line">	<span class="keyword">parameter</span> S=<span class="number">0</span>, S1=<span class="number">1</span>, S10=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">reg</span>[<span class="number">1</span>:<span class="number">0</span>] state, next;		<span class="comment">// Make sure state and next are big enough to hold the state encodings.</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Edge-triggered always block (DFFs) for state flip-flops. Asynchronous reset.			</span></span><br><span class="line">	<span class="keyword">always</span>@(<span class="keyword">posedge</span> clk, <span class="keyword">negedge</span> aresetn)</span><br><span class="line">		<span class="keyword">if</span> (!aresetn)</span><br><span class="line">			state &lt;= S;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			state &lt;= next;</span><br><span class="line">			</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Combinational always block for state transition logic. Given the current state and inputs,</span></span><br><span class="line">    <span class="comment">// what should be next state be?</span></span><br><span class="line">    <span class="comment">// Combinational always block: Use blocking assignments.    </span></span><br><span class="line">	<span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">case</span> (state)</span><br><span class="line">			S: next = x ? S1 : S;</span><br><span class="line">			S1: next = x ? S1 : S10;</span><br><span class="line">			S10: next = x ? S1 : S;</span><br><span class="line">			<span class="keyword">default</span>: next = &#x27;x;</span><br><span class="line">		<span class="keyword">endcase</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// Combinational output logic. I used a combinational always block.</span></span><br><span class="line">	<span class="comment">// In a Mealy state machine, the output depends on the current state *and*</span></span><br><span class="line">	<span class="comment">// the inputs.</span></span><br><span class="line">	<span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">case</span> (state)</span><br><span class="line">			S: z = <span class="number">0</span>;</span><br><span class="line">			S1: z = <span class="number">0</span>;</span><br><span class="line">			S10: z = x;		<span class="comment">// This is a Mealy state machine: The output can depend (combinational) on the input.</span></span><br><span class="line">			<span class="keyword">default</span>: z = <span class="number">1&#x27;bx</span>;</span><br><span class="line">		<span class="keyword">endcase</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-ece241-2014-q5a"><a href="#Exams-x2F-ece241-2014-q5a" class="headerlink" title="Exams&#x2F;ece241 2014 q5a"></a>Exams&#x2F;ece241 2014 q5a</h2><blockquote>
<p>注意：这道题默认输入是负数并且省略了符号位。</p>
</blockquote>
<h3 id="Question-3"><a href="#Question-3" class="headerlink" title="Question"></a>Question</h3><p>You are to design a one-input one-output serial 2’s complementer <strong>Moore</strong> state machine. The input (x) is a series of bits (one per clock cycle) beginning with the least-significant bit of the number, and the output (Z) is the 2’s complement of the input. The machine will accept input numbers of arbitrary length. The circuit requires an asynchronous reset. The conversion begins when <em>Reset</em> is released and stops when <em>Reset</em> is asserted.</p>
<p>For example:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822104655.png" alt="wf"></p>
<h3 id="Module-Declaration-20"><a href="#Module-Declaration-20" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-8"><a href="#Solution-8" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> IDLE = <span class="number">2&#x27;b00</span>, S1 = <span class="number">2&#x27;b01</span>, S10 = <span class="number">2&#x27;b10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE : next_state = x ? S1 : IDLE;</span><br><span class="line">            S1 : next_state = x ? S10 : S1;</span><br><span class="line">            S10 : next_state = x ? S10 : S1;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> z = (state == S1);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-5"><a href="#Debug-5" class="headerlink" title="Debug"></a>Debug</h3><p>最开始状态机画错了，正确的长成这个样子：</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/C5A74A26154A87EFFE5683F293889EFB.png" alt="sm"></p>
<h2 id="Exams-x2F-ece241-2014-q5b"><a href="#Exams-x2F-ece241-2014-q5b" class="headerlink" title="Exams&#x2F;ece241 2014 q5b"></a>Exams&#x2F;ece241 2014 q5b</h2><h3 id="Question-4"><a href="#Question-4" class="headerlink" title="Question"></a>Question</h3><p>The following diagram is a <strong>Mealy</strong> machine implementation of the 2’s complementer. Implement using one-hot encoding.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822110111.png" alt="sm"></p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822110010.png" alt="wf"></p>
<h3 id="Module-Declaration-21"><a href="#Module-Declaration-21" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">        <span class="keyword">input</span> clk,</span><br><span class="line">        <span class="keyword">input</span> areset,</span><br><span class="line">        <span class="keyword">input</span> x,</span><br><span class="line">        <span class="keyword">output</span> z</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<h3 id="Solution-9"><a href="#Solution-9" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">2&#x27;b00</span>, B = <span class="number">2&#x27;b10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = x ? B : A;</span><br><span class="line">            B : next_state = B;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> z = ((state == A) &amp; ( x == <span class="number">1&#x27;b1</span>)) | ((state == B) &amp; (x == <span class="number">0</span>));</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-2014-q3fsm"><a href="#Exams-x2F-2014-q3fsm" class="headerlink" title="Exams&#x2F;2014 q3fsm"></a>Exams&#x2F;2014 q3fsm</h2><h3 id="Question-5"><a href="#Question-5" class="headerlink" title="Question"></a>Question</h3><p>Consider a finite state machine with inputs <em>s</em> and <em>w</em>. Assume that the FSM begins in a reset state called <em>A</em>, as depicted below. The FSM remains in state <em>A</em> as long as <em>s</em> &#x3D; 0, and it moves to state <em>B</em> when <em>s</em> &#x3D; 1. Once in state <em>B</em> the FSM examines the value of the input <em>w</em> in the next three clock cycles. If <em>w</em> &#x3D; 1 in exactly two of these clock cycles, then the FSM has to set an output <em>z</em> to 1 in the following clock cycle. Otherwise <em>z</em> has to be 0. The FSM continues checking <em>w</em> for the next three clock cycles, and so on. The timing diagram below illustrates the required values of <em>z</em> for different values of <em>w</em>.</p>
<p>Use as few states as possible. Note that the <em>s</em> input is used only in state <em>A</em>, so you need to consider just the <em>w</em> input.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822210017.png" alt="wf"></p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822210035.png" alt="sm"></p>
<h3 id="Module-Declaration-22"><a href="#Module-Declaration-22" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,   <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> s,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> z</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-10"><a href="#Solution-10" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,   <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> s,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> z);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">1&#x27;b0</span>, B = <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] f_cnt;</span><br><span class="line">    <span class="keyword">reg</span> flag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = s ? B : A;</span><br><span class="line">            B : next_state = B;</span><br><span class="line">            <span class="keyword">default</span> : next_state = B;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (state == B) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (cnt == <span class="number">2&#x27;b10</span>) cnt &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                cnt &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            flag &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (cnt == <span class="number">2&#x27;b10</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> ((f_cnt == <span class="number">2&#x27;b01</span>) &amp;&amp; (w == <span class="number">1&#x27;b1</span>)) </span><br><span class="line">                    flag &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> ((f_cnt == <span class="number">2&#x27;b10</span>) &amp;&amp; (w == <span class="number">1&#x27;b0</span>)) <span class="keyword">begin</span></span><br><span class="line">                    flag &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">if</span> (flag == <span class="number">1&#x27;b1</span>) </span><br><span class="line">                flag &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            f_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// 最开始这里没有判断在 state == B, 出现了bug</span></span><br><span class="line">            <span class="keyword">if</span> (state == B) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (cnt == <span class="number">2&#x27;b10</span>) </span><br><span class="line">                    f_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (w == <span class="number">1&#x27;b1</span>) </span><br><span class="line">                    f_cnt &lt;= f_cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    f_cnt &lt;= f_cnt;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> z = flag;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-6"><a href="#Debug-6" class="headerlink" title="Debug"></a>Debug</h3><p>见代码注释</p>
<h2 id="Exams-x2F-2014-q3bfsm"><a href="#Exams-x2F-2014-q3bfsm" class="headerlink" title="Exams&#x2F;2014 q3bfsm"></a>Exams&#x2F;2014 q3bfsm</h2><h3 id="Question-6"><a href="#Question-6" class="headerlink" title="Question"></a>Question</h3><p>Given the state-assigned table shown below, implement the finite-state machine. Reset should reset the FSM to state 000.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822153244.png" alt="table"></p>
<h3 id="Module-Declaration-23"><a href="#Module-Declaration-23" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,   <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-11"><a href="#Solution-11" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,   <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> z);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = x ? B : A;</span><br><span class="line">            B : next_state = x ? E : B;</span><br><span class="line">            C : next_state = x ? B : C;</span><br><span class="line">            D : next_state = x ? C : B;</span><br><span class="line">            E : next_state = x ? E : D;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> z = (state == D) | (state == E);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-2014-q3c"><a href="#Exams-x2F-2014-q3c" class="headerlink" title="Exams&#x2F;2014 q3c"></a>Exams&#x2F;2014 q3c</h2><h3 id="Question-7"><a href="#Question-7" class="headerlink" title="Question"></a>Question</h3><p>Given the state-assigned table shown below, implement the logic functions Y[0] and z.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822153244.png" alt="table"></p>
<h3 id="Module-Declaration-24"><a href="#Module-Declaration-24" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] y,</span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> Y0,</span><br><span class="line">    <span class="keyword">output</span> z</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-12"><a href="#Solution-12" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] y,</span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">output</span> Y0,</span><br><span class="line">    <span class="keyword">output</span> z</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (y)</span><br><span class="line">            A : next_state = x ? B : A;</span><br><span class="line">            B : next_state = x ? E : B;</span><br><span class="line">            C : next_state = x ? B : C;</span><br><span class="line">            D : next_state = x ? C : B;</span><br><span class="line">            E : next_state = x ? E : D;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> z = (y == D) | (y == E);</span><br><span class="line">    <span class="keyword">assign</span> Y0 = next_state[<span class="number">0</span>];</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-m2014-q6b"><a href="#Exams-x2F-m2014-q6b" class="headerlink" title="Exams&#x2F;m2014 q6b"></a>Exams&#x2F;m2014 q6b</h2><p>Consider the state machine shown below, which has one input <em>w</em> and one output <em>z</em>.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822154818.png" alt="sm"></p>
<p>Assume that you wish to implement the FSM using three flip-flops and state codes <em>y[3:1] &#x3D;</em> 000, 001, … , 101 for states A, B, … , F, respectively. Show a state-assigned table for this FSM. Derive a next-state expression for the flip-flop <em>y[2]</em>.</p>
<p>Implement just the next-state logic for <em>y[2]</em>. (This is much more a FSM question than a Verilog coding question. Oh well.)</p>
<h3 id="Module-Declaration-25"><a href="#Module-Declaration-25" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] y,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> Y2);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-13"><a href="#Solution-13" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] y,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> Y2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>, F = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">1</span>] next_state;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (y)</span><br><span class="line">            A : next_state = w ? A : B;</span><br><span class="line">            B : next_state = w ? D : C;</span><br><span class="line">            C : next_state = w ? D : E;</span><br><span class="line">            D : next_state = w ? A : F;</span><br><span class="line">            E : next_state = w ? D : E;</span><br><span class="line">            F : next_state = w ? D : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y2 = next_state[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h3><p>这道题理论上应该使用数电课上学的状态机到电路的实现方法来做，使用ffr的情况。</p>
<h2 id="Exams-x2F-m2014-q6c"><a href="#Exams-x2F-m2014-q6c" class="headerlink" title="Exams&#x2F;m2014 q6c"></a>Exams&#x2F;m2014 q6c</h2><h3 id="Question-8"><a href="#Question-8" class="headerlink" title="Question"></a>Question</h3><p>Consider the state machine shown below, which has one input <em>w</em> and one output <em>z</em>.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822154818.png" alt="sm"></p>
<p>For this part, assume that a one-hot code is used with the state assignment ‘y[6:1]_ &#x3D; 000001, 000010, 000100, 001000, 010000, 100000 for states A, B,…, F, respectively._</p>
<p>Write a logic expression for the next-state signals Y2 and Y4. (Derive the logic equations by inspection assuming a one-hot encoding. The testbench will test with non-one hot inputs to make sure you’re not trying to do something more complicated).</p>
<h3 id="Module-Declaration-26"><a href="#Module-Declaration-26" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">6</span>:<span class="number">1</span>] y,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> Y2,</span><br><span class="line">    <span class="keyword">output</span> Y4);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-14"><a href="#Solution-14" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">6</span>:<span class="number">1</span>] y,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> Y2,</span><br><span class="line">    <span class="keyword">output</span> Y4);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        Y2 = (~ w) &amp; y[<span class="number">1</span>];</span><br><span class="line">        Y4 = w &amp; (y[<span class="number">2</span>] | y[<span class="number">3</span>] | y[<span class="number">5</span>] | y[<span class="number">6</span>]);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-m2014-q6"><a href="#Exams-x2F-m2014-q6" class="headerlink" title="Exams&#x2F;m2014 q6"></a>Exams&#x2F;m2014 q6</h2><h3 id="Question-9"><a href="#Question-9" class="headerlink" title="Question"></a>Question</h3><p>Consider the state machine shown below, which has one input <em>w</em> and one output <em>z</em>.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220822154818.png" alt="sm"></p>
<p>Implement the state machine. (This part wasn’t on the midterm, but coding up FSMs is good practice).</p>
<h3 id="Module-Declaration-27"><a href="#Module-Declaration-27" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,     <span class="comment">// synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> z);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-15"><a href="#Solution-15" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,     <span class="comment">// synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> z);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>, F = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">1</span>] state, next_state;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = w ? A : B;</span><br><span class="line">            B : next_state = w ? D : C;</span><br><span class="line">            C : next_state = w ? D : E;</span><br><span class="line">            D : next_state = w ? A : F;</span><br><span class="line">            E : next_state = w ? D : E;</span><br><span class="line">            F : next_state = w ? D : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> z = (state == E) | (state == F);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="Exams-x2F-2012-q2fsm"><a href="#Exams-x2F-2012-q2fsm" class="headerlink" title="Exams&#x2F;2012 q2fsm"></a>Exams&#x2F;2012 q2fsm</h2><h3 id="Question-10"><a href="#Question-10" class="headerlink" title="Question"></a>Question</h3><p>Consider the state diagram shown below.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220823080859.png" alt="sm"></p>
<p>Write complete Verilog code that represents this FSM. Use separate <strong>always</strong> blocks for the state table and the state flip-flops, as done in lectures. Describe the FSM output, which is called <em>z</em>, using either continuous assignment statement(s) or an <strong>always</strong> block (at your discretion). Assign any state codes that you wish to use.</p>
<h3 id="Module-Declaration-28"><a href="#Module-Declaration-28" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,   <span class="comment">// Synchronous active-high reset</span></span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> z</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-16"><a href="#Solution-16" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,     <span class="comment">// synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> z);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>, F = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">1</span>] state, next_state;</span><br><span class="line">    <span class="keyword">wire</span> r_w;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> r_w = ~w;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = r_w ? A : B;</span><br><span class="line">            B : next_state = r_w ? D : C;</span><br><span class="line">            C : next_state = r_w ? D : E;</span><br><span class="line">            D : next_state = r_w ? A : F;</span><br><span class="line">            E : next_state = r_w ? D : E;</span><br><span class="line">            F : next_state = r_w ? D : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> z = (state == E) | (state == F);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-7"><a href="#Debug-7" class="headerlink" title="Debug"></a>Debug</h3><p>注意状态机和上面几个不一样。</p>
<h2 id="Exams-x2F-2012-q2b"><a href="#Exams-x2F-2012-q2b" class="headerlink" title="Exams&#x2F;2012 q2b"></a>Exams&#x2F;2012 q2b</h2><h3 id="Question-11"><a href="#Question-11" class="headerlink" title="Question"></a>Question</h3><p>The state diagram for this question is shown again below.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220823080859.png" alt="sm"></p>
<p>Assume that a one-hot code is used with the state assignment <em>y[5:0]</em> &#x3D; 000001(A), 000010(B), 000100(C), 001000(D), 010000(E), 100000(F)</p>
<p>Write a logic expression for the signal <em>Y1</em>, which is the input of state flip-flop <em>y[1]</em>.</p>
<p>Write a logic expression for the signal <em>Y3</em>, which is the input of state flip-flop <em>y[3]</em>.</p>
<p>(Derive the logic equations by inspection assuming a one-hot encoding. The testbench will test with non-one hot inputs to make sure you’re not trying to do something more complicated).</p>
<h3 id="Module-Declaration-29"><a href="#Module-Declaration-29" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] y,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> Y1,</span><br><span class="line">    <span class="keyword">output</span> Y3</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Logic equations for one-hot state transition logic can be derived by looking at in-edges of the state transition diagram.</p>
<h3 id="Solution-17"><a href="#Solution-17" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] y,</span><br><span class="line">    <span class="keyword">input</span> w,</span><br><span class="line">    <span class="keyword">output</span> Y1,</span><br><span class="line">    <span class="keyword">output</span> Y3);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> Y1 = w &amp; y[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> Y3 = ~w &amp; (y[<span class="number">1</span>] | y[<span class="number">2</span>] | y[<span class="number">4</span>] | y[<span class="number">5</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-2013-q2afsm"><a href="#Exams-x2F-2013-q2afsm" class="headerlink" title="Exams&#x2F;2013 q2afsm"></a>Exams&#x2F;2013 q2afsm</h2><h3 id="Question-12"><a href="#Question-12" class="headerlink" title="Question"></a>Question</h3><p>Consider the FSM described by the state diagram shown below:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220823104213.png" alt="sm"></p>
<p>This FSM acts as an arbiter circuit, which controls access to some type of resource by three requesting devices. Each device makes its request for the resource by setting a signal <em>r[i]</em> &#x3D; 1, where <em>r[i]</em> is either <em>r[1]</em>, <em>r[2]</em>, or <em>r[3]</em>. Each r[i] is an input signal to the FSM, and represents one of the three devices. The FSM stays in state <em>A</em> as long as there are no requests. When one or more request occurs, then the FSM decides which device receives a grant to use the resource and changes to a state that sets that device’s <em>g[i]</em> signal to 1. Each <em>g[i]</em> is an output from the FSM. There is a priority system, in that device 1 has a higher priority than device 2, and device 3 has the lowest priority. Hence, for example, device 3 will only receive a grant if it is the only device making a request when the FSM is in state <em>A</em>. Once a device, <em>i</em>, is given a grant by the FSM, that device continues to receive the grant as long as its request, <em>r[i]</em> &#x3D; 1.</p>
<p>Write complete Verilog code that represents this FSM. Use separate always blocks for the state table and the state flip-flops, as done in lectures. Describe the FSM outputs, <em>g[i]</em>, using either continuous assignment statement(s) or an always block (at your discretion). Assign any state codes that you wish to use.</p>
<h3 id="Module-Declaration-30"><a href="#Module-Declaration-30" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> resetn,    <span class="comment">// active-low synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] r,   <span class="comment">// request</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">1</span>] g   <span class="comment">// grant</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-18"><a href="#Solution-18" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> resetn,    <span class="comment">// active-low synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] r,   <span class="comment">// request</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">1</span>] g   <span class="comment">// grant</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">2&#x27;b00</span>, B = <span class="number">2&#x27;b01</span>, C = <span class="number">2&#x27;b10</span>, D = <span class="number">2&#x27;b11</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = r[<span class="number">1</span>] ? B : r[<span class="number">2</span>] ? C : r[<span class="number">3</span>] ? D : A;</span><br><span class="line">            B : next_state = r[<span class="number">1</span>] ? B : A;</span><br><span class="line">            C : next_state = r[<span class="number">2</span>] ? C : A;</span><br><span class="line">            D : next_state = r[<span class="number">3</span>] ? D : A;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~resetn) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> g[<span class="number">1</span>] = (state == B);</span><br><span class="line">    <span class="keyword">assign</span> g[<span class="number">2</span>] = (state == C);</span><br><span class="line">    <span class="keyword">assign</span> g[<span class="number">3</span>] = (state == D);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-2013-q2bfsm"><a href="#Exams-x2F-2013-q2bfsm" class="headerlink" title="Exams&#x2F;2013 q2bfsm"></a>Exams&#x2F;2013 q2bfsm</h2><h3 id="Question-13"><a href="#Question-13" class="headerlink" title="Question"></a>Question</h3><p>Consider a finite state machine that is used to control some type of motor. The FSM has inputs <em>x</em> and <em>y</em>, which come from the motor, and produces outputs <em>f</em> and <em>g</em>, which control the motor. There is also a clock input called <em>clk</em> and a reset input called <em>resetn</em>.</p>
<p>The FSM has to work as follows. As long as the reset input is asserted, the FSM stays in a beginning state, called state <em>A</em>. When the reset signal is de-asserted, then after the next clock edge the FSM has to set the output <em>f</em> to 1 for one clock cycle. <strong>Then</strong>, the FSM has to monitor the <em>x</em> input. When <em>x</em> has produced the values 1, 0, 1 in three successive clock cycles, then <em>g</em> should be set to 1 on the following clock cycle. While maintaining <em>g</em> &#x3D; 1 the FSM has to monitor the <em>y</em> input. If <em>y</em> has the value 1 within at most two clock cycles, then the FSM should maintain <em>g</em> &#x3D; 1 permanently (that is, until reset). But if <em>y</em> does not become 1 within two clock cycles, then the FSM should set <em>g</em> &#x3D; 0 permanently (until reset).</p>
<p>(The original exam question asked for a state diagram only. But here, implement the FSM.)</p>
<h3 id="Module-Declaration-31"><a href="#Module-Declaration-31" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> resetn,    <span class="comment">// active-low synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">input</span> y,</span><br><span class="line">    <span class="keyword">output</span> f,</span><br><span class="line">    <span class="keyword">output</span> g</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-19"><a href="#Solution-19" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> resetn,    <span class="comment">// active-low synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> x,</span><br><span class="line">    <span class="keyword">input</span> y,</span><br><span class="line">    <span class="keyword">output</span> f,</span><br><span class="line">    <span class="keyword">output</span> g</span><br><span class="line">    ); </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>, F = <span class="number">5</span>, G = <span class="number">6</span>, H = <span class="number">7</span>, I = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = B;</span><br><span class="line">            B : next_state = C;</span><br><span class="line">            C : next_state = x ? D : C;</span><br><span class="line">            D : next_state = x ? D : E;</span><br><span class="line">            E : next_state = x ? F : C;</span><br><span class="line">            F : next_state = y ? I : G;</span><br><span class="line">            G : next_state = y ? I : H;</span><br><span class="line">            H : next_state = H;</span><br><span class="line">            I : next_state = I;</span><br><span class="line">            <span class="keyword">default</span> : next_state = A;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~resetn)</span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;     </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> f = (state == B);</span><br><span class="line">    <span class="keyword">assign</span> g = (state == F) | (state == G) | (state == I);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-review2015-count1k"><a href="#Exams-x2F-review2015-count1k" class="headerlink" title="Exams&#x2F;review2015 count1k"></a>Exams&#x2F;review2015 count1k</h2><h3 id="Question-14"><a href="#Question-14" class="headerlink" title="Question"></a>Question</h3><p>Build a counter that counts from 0 to 999, inclusive, with a period of 1000 cycles. The reset input is synchronous, and should reset the counter to 0.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220824103438.png" alt="wf"></p>
<h3 id="Module-Declaration-32"><a href="#Module-Declaration-32" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] q);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-20"><a href="#Solution-20" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] q);</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            q &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (q &gt; <span class="number">10&#x27;d998</span>) </span><br><span class="line">            	q &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                q &lt;= q + <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-review2015-shiftcount"><a href="#Exams-x2F-review2015-shiftcount" class="headerlink" title="Exams&#x2F;review2015 shiftcount"></a>Exams&#x2F;review2015 shiftcount</h2><h3 id="Question-15"><a href="#Question-15" class="headerlink" title="Question"></a>Question</h3><p><em>This is the first component in a series of five exercises that builds a complex counter out of several smaller circuits. See <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fancytimer" title="exams/review2015_fancytimer">the final exercise</a> for the overall design.</em></p>
<p>Build a four-bit shift register that also acts as a down counter. Data is shifted in most-significant-bit first when shift_ena is 1. The number currently in the shift register is decremented when count_ena is 1. Since the full system doesn’t ever use shift_ena and count_ena together, it does not matter what your circuit does if both control inputs are 1 (This mainly means that it doesn’t matter which case gets higher priority).</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220824173044.png" alt="wf"></p>
<h3 id="Module-Declaration-33"><a href="#Module-Declaration-33" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> shift_ena,</span><br><span class="line">    <span class="keyword">input</span> count_ena,</span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] q);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-21"><a href="#Solution-21" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> shift_ena,</span><br><span class="line">    <span class="keyword">input</span> count_ena,</span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] q);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (shift_ena) <span class="keyword">begin</span></span><br><span class="line">            q &lt;= &#123;q[<span class="number">2</span>:<span class="number">0</span>], data&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            q &lt;= q;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">if</span> (count_ena) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (q == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                q &lt;= <span class="number">4&#x27;d15</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                q &lt;= q - <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-8"><a href="#Debug-8" class="headerlink" title="Debug"></a>Debug</h3><p>开始还有一点问题，就是data延迟了一个周期再输入，其实不用，本来就会有一个周期的延迟。</p>
<h2 id="Exams-x2F-review2015-fsmseq"><a href="#Exams-x2F-review2015-fsmseq" class="headerlink" title="Exams&#x2F;review2015 fsmseq"></a>Exams&#x2F;review2015 fsmseq</h2><h3 id="Question-16"><a href="#Question-16" class="headerlink" title="Question"></a>Question</h3><p><em>This is the second component in a series of five exercises that builds a complex counter out of several smaller circuits. See <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fancytimer" title="exams/review2015_fancytimer">the final exercise</a> for the overall design.</em></p>
<p>Build a finite-state machine that searches for the sequence 1101 in an input bit stream. When the sequence is found, it should set start_shifting to 1, forever, until reset. Getting stuck in the final state is intended to model going to other states in a bigger FSM that is not yet implemented. We will be extending this FSM in the next few exercises.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220824204709.png" alt="wf"></p>
<h3 id="Module-Declaration-34"><a href="#Module-Declaration-34" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> start_shifting);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-22"><a href="#Solution-22" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> start_shifting);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> A = <span class="number">0</span>, B = <span class="number">1</span>, C = <span class="number">2</span>, D = <span class="number">3</span>, E = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : next_state = data ? B : A;</span><br><span class="line">            B : next_state = data ? C : A;</span><br><span class="line">            C : next_state = data ? C : D;</span><br><span class="line">            D : next_state = data ? E : A;</span><br><span class="line">            E : next_state = E;</span><br><span class="line">            <span class="keyword">default</span> : next_state = A;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;     </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> start_shifting = (state == E);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-review2015-fsmshift"><a href="#Exams-x2F-review2015-fsmshift" class="headerlink" title="Exams&#x2F;review2015 fsmshift"></a>Exams&#x2F;review2015 fsmshift</h2><h3 id="Question-17"><a href="#Question-17" class="headerlink" title="Question"></a>Question</h3><p><em>This is the third component in a series of five exercises that builds a complex counter out of several smaller circuits. See <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fancytimer" title="exams/review2015_fancytimer">the final exercise</a> for the overall design.</em></p>
<p>As part of the FSM for controlling the shift register, we want the ability to enable the shift register for exactly 4 clock cycles whenever the proper bit pattern is detected. We handle sequence detection in <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Exams/review2015_fsmseq" title="Exams/review2015 fsmseq">Exams&#x2F;review2015_fsmseq</a>, so this portion of the FSM only handles enabling the shift register for 4 cycles.</p>
<p>Whenever the FSM is reset, assert shift_ena for 4 cycles, then 0 forever (until reset).</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220824211056.png" alt="wf"></p>
<h3 id="Module-Declaration-35"><a href="#Module-Declaration-35" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> shift_ena);</span><br></pre></td></tr></table></figure>

<h3 id="Soltuion"><a href="#Soltuion" class="headerlink" title="Soltuion"></a>Soltuion</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">output</span> shift_ena);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] cnt;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (cnt == <span class="number">4&#x27;d3</span>)</span><br><span class="line">                cnt &lt;= <span class="number">4&#x27;d3</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            	cnt &lt;= cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">        	shift_ena &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (cnt == <span class="number">4&#x27;d3</span>)</span><br><span class="line">                shift_ena &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                shift_ena &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-review2015-fsm"><a href="#Exams-x2F-review2015-fsm" class="headerlink" title="Exams&#x2F;review2015 fsm"></a>Exams&#x2F;review2015 fsm</h2><h3 id="Question-18"><a href="#Question-18" class="headerlink" title="Question"></a>Question</h3><p><em>This is the fourth component in a series of five exercises that builds a complex counter out of several smaller circuits. See <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fancytimer" title="exams/review2015_fancytimer">the final exercise</a> for the overall design.</em></p>
<p>You may wish to do <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Exams/review2015_fsmshift" title="Exams/review2015 fsmshift">FSM: Enable shift register</a> and <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Exams/review2015_fsmseq" title="Exams/review2015 fsmseq">FSM: Sequence recognizer</a> first.</p>
<p>We want to create a timer that:</p>
<ol>
<li>is started when a particular pattern (1101) is detected,</li>
<li>shifts in 4 more bits to determine the duration to delay,</li>
<li>waits for the counters to finish counting, and</li>
<li>notifies the user and waits for the user to acknowledge the timer.</li>
</ol>
<p>In this problem, implement just the finite-state machine that controls the timer. The data path (counters and some comparators) are not included here.</p>
<p>The serial data is available on the data input pin. When the pattern 1101 is received, the state machine must then assert output shift_ena for exactly 4 clock cycles.</p>
<p>After that, the state machine asserts its counting output to indicate it is waiting for the counters, and waits until input done_counting is high.</p>
<p>At that point, the state machine must assert done to notify the user the timer has timed out, and waits until input ack is 1 before being reset to look for the next occurrence of the start sequence (1101).</p>
<p>The state machine should reset into a state where it begins searching for the input sequence 1101.</p>
<p>Here is an example of the expected inputs and outputs. The ‘x’ states may be slightly confusing to read. They indicate that the FSM should not care about that particular input signal in that cycle. For example, once a 1101 pattern is detected, the FSM no longer looks at the data input until it resumes searching after everything else is done.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220826162433.png" alt="wf"></p>
<h3 id="Module-Declaration-36"><a href="#Module-Declaration-36" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> shift_ena,</span><br><span class="line">    <span class="keyword">output</span> counting,</span><br><span class="line">    <span class="keyword">input</span> done_counting,</span><br><span class="line">    <span class="keyword">output</span> done,</span><br><span class="line">    <span class="keyword">input</span> ack );</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220826162619.png" alt="hint" title="hint"></p>
<h3 id="Solution-23"><a href="#Solution-23" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> shift_ena,</span><br><span class="line">    <span class="keyword">output</span> counting,</span><br><span class="line">    <span class="keyword">input</span> done_counting,</span><br><span class="line">    <span class="keyword">output</span> done,</span><br><span class="line">    <span class="keyword">input</span> ack );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> S = <span class="number">0</span>, S1 = <span class="number">1</span>, S11 = <span class="number">2</span>, S110 = <span class="number">3</span>, B0 = <span class="number">4</span>, B1 = <span class="number">5</span>, B2 = <span class="number">6</span>, B3 = <span class="number">7</span>,</span><br><span class="line">                COUNT = <span class="number">8</span>, WAIT = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            S : next_state = data ? S1 : S;</span><br><span class="line">            S1 : next_state = data ? S11 : S;</span><br><span class="line">            S11 : next_state = data ? S11 : S110;</span><br><span class="line">            S110 : next_state = data ? B0 : S;</span><br><span class="line">            B0 : next_state = B1;</span><br><span class="line">            B1 : next_state = B2;</span><br><span class="line">            B2 : next_state = B3;</span><br><span class="line">            B3 : next_state = COUNT;</span><br><span class="line">            COUNT : next_state = done_counting ? WAIT : COUNT;</span><br><span class="line">            WAIT : next_state = ack ? S : WAIT; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            state &lt;= S;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> shift_ena = ((state == B0) | (state == B1) | (state == B2) | </span><br><span class="line">                        (state == B3));</span><br><span class="line">    <span class="keyword">assign</span> counting = (state == COUNT);</span><br><span class="line">    <span class="keyword">assign</span> done = (state == WAIT);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h2 id="Exams-x2F-review2015-fancytimer"><a href="#Exams-x2F-review2015-fancytimer" class="headerlink" title="Exams&#x2F;review2015 fancytimer"></a>Exams&#x2F;review2015 fancytimer</h2><h3 id="Question-19"><a href="#Question-19" class="headerlink" title="Question"></a>Question</h3><p><em>This is the fifth component in a series of five exercises that builds a complex counter out of several smaller circuits. You may wish to do the four previous exercises first (<a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_shiftcount" title="exams/review2015_shiftcount">counter</a>, <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fsmseq" title="exams/review2015_fsmseq">sequence recognizer FSM</a>, <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fsmshift" title="exams/review2015_fsmshift">FSM delay</a>, and <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/exams/review2015_fsm" title="exams/review2015_fsm">combined FSM</a>).</em></p>
<p>We want to create a timer with one input that:</p>
<ol>
<li>is started when a particular input pattern (1101) is detected,</li>
<li>shifts in 4 more bits to determine the duration to delay,</li>
<li>waits for the counters to finish counting, and</li>
<li>notifies the user and waits for the user to acknowledge the timer.</li>
</ol>
<p>The serial data is available on the data input pin. When the pattern 1101 is received, the circuit must then shift in the next 4 bits, most-significant-bit first. These 4 bits determine the duration of the timer delay. I’ll refer to this as the delay[3:0].</p>
<p>After that, the state machine asserts its counting output to indicate it is counting. The state machine must count for exactly (delay[3:0] + 1) * 1000 clock cycles. e.g., delay&#x3D;0 means count 1000 cycles, and delay&#x3D;5 means count 6000 cycles. Also output the current remaining time. This should be equal to delay for 1000 cycles, then delay-1 for 1000 cycles, and so on until it is 0 for 1000 cycles. When the circuit isn’t counting, the count[3:0] output is don’t-care (whatever value is convenient for you to implement).</p>
<p>At that point, the circuit must assert done to notify the user the timer has timed out, and waits until input ack is 1 before being reset to look for the next occurrence of the start sequence (1101).</p>
<p>The circuit should reset into a state where it begins searching for the input sequence 1101.</p>
<p>Here is an example of the expected inputs and outputs. The ‘x’ states may be slightly confusing to read. They indicate that the FSM should not care about that particular input signal in that cycle. For example, once the 1101 and delay[3:0] have been read, the circuit no longer looks at the data input until it resumes searching after everything else is done. In this example, the circuit counts for 2000 clock cycles because the delay[3:0] value was 4’b0001. The last few cycles starts another count with delay[3:0] &#x3D; 4’b1110, which will count for 15000 cycles.</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220828164209.png" alt="wf" title="wf"></p>
<h3 id="Module-Declaration-37"><a href="#Module-Declaration-37" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] count,</span><br><span class="line">    <span class="keyword">output</span> counting,</span><br><span class="line">    <span class="keyword">output</span> done,</span><br><span class="line">    <span class="keyword">input</span> ack );</span><br></pre></td></tr></table></figure>

<h4 id="Hint-1"><a href="#Hint-1" class="headerlink" title="Hint"></a>Hint</h4><blockquote>
<p>The hardware should be approximately the FSM from <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Exams/review2015_fsm" title="Exams/review2015 fsm">Exams&#x2F;review2015_fsm</a>, the counter from <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Exams/review2015_count1k" title="Exams/review2015 count1k">Exams&#x2F;review2015_count1k</a>, and the shift register+counter from <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Exams/review2015_shiftcount" title="Exams/review2015 shiftcount">Exams&#x2F;review2015_shiftcount</a>. You’ll probably need a few more comparators here.</p>
<p>It’s ok to have all the code in a single module if the components are in their own always blocks, as long as it’s clear which blob of code corresponds to which hardware block. Don’t merge multiple always blocks together, as that’s hard to read and error-prone.</p>
</blockquote>
<h3 id="Solution-24"><a href="#Solution-24" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,      <span class="comment">// Synchronous reset</span></span><br><span class="line">    <span class="keyword">input</span> data,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] count,</span><br><span class="line">    <span class="keyword">output</span> counting,</span><br><span class="line">    <span class="keyword">output</span> done,</span><br><span class="line">    <span class="keyword">input</span> ack );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">localparam</span> S = <span class="number">0</span>, S1 = <span class="number">1</span>, S11 = <span class="number">2</span>, S110 = <span class="number">3</span>, B0 = <span class="number">4</span>, B1 = <span class="number">5</span>, B2 = <span class="number">6</span>, B3 = <span class="number">7</span>,</span><br><span class="line">                COUNT = <span class="number">8</span>, WAIT = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] delay;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] k_cnt, d_cnt; <span class="comment">// kilo_counter, delay_counter</span></span><br><span class="line">    <span class="keyword">reg</span> shift_ena, done_counting;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            S : next_state = data ? S1 : S;</span><br><span class="line">            S1 : next_state = data ? S11 : S;</span><br><span class="line">            S11 : next_state = data ? S11 : S110;</span><br><span class="line">            S110 : next_state = data ? B0 : S;</span><br><span class="line">            B0 : next_state = B1;</span><br><span class="line">            B1 : next_state = B2;</span><br><span class="line">            B2 : next_state = B3;</span><br><span class="line">            B3 : next_state = COUNT;</span><br><span class="line">            COUNT : next_state = done_counting ? WAIT : COUNT;</span><br><span class="line">            WAIT : next_state = ack ? S : WAIT; </span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)</span><br><span class="line">            state &lt;= S;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> shift_ena = ((state == B0) | (state == B1) | (state == B2) | </span><br><span class="line">                        (state == B3));</span><br><span class="line">    <span class="keyword">assign</span> counting = (state == COUNT);</span><br><span class="line">    <span class="keyword">assign</span> done = (state == WAIT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            delay &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (shift_ena) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">integer</span> i;</span><br><span class="line">                delay[<span class="number">0</span>] &lt;= data; </span><br><span class="line">                <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : loop</span><br><span class="line">                    delay[i + <span class="number">1</span>] &lt;= delay[i]; </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            k_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (counting) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (k_cnt == <span class="number">10&#x27;d999</span>) <span class="keyword">begin</span></span><br><span class="line">                    k_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    k_cnt &lt;= k_cnt + <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            d_cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (state == B3) <span class="keyword">begin</span></span><br><span class="line">                d_cnt &lt;= &#123;delay[<span class="number">2</span>:<span class="number">0</span>], data&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (k_cnt == <span class="number">10&#x27;d999</span>) <span class="keyword">begin</span></span><br><span class="line">                d_cnt &lt;= d_cnt - <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            done_counting &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> ((k_cnt == <span class="number">10&#x27;d998</span>) &amp; (d_cnt == <span class="number">0</span>)) <span class="keyword">begin</span></span><br><span class="line">                done_counting &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                done_counting &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> count = d_cnt;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-9"><a href="#Debug-9" class="headerlink" title="Debug"></a>Debug</h3><ol>
<li>开始边界条件写错了，<code>k_cnt == 10&#39;d998</code> 多写了一个数。</li>
</ol>
<h2 id="Exams-x2F-review2015-fsmonehot"><a href="#Exams-x2F-review2015-fsmonehot" class="headerlink" title="Exams&#x2F;review2015 fsmonehot"></a>Exams&#x2F;review2015 fsmonehot</h2><h3 id="Question-20"><a href="#Question-20" class="headerlink" title="Question"></a>Question</h3><p>Given the following state machine with 3 inputs, 3 outputs, and 10 states:</p>
<p><img src="https://raw.githubusercontent.com/PengXuanyao/img-bed/main/20220828164700.png" alt="sm"></p>
<p>Derive next-state logic equations and output logic equations <em>by inspection</em> assuming the following one-hot encoding is used: (S, S1, S11, S110, B0, B1, B2, B3, Count, Wait) &#x3D; (10’b0000000001, 10’b0000000010, 10’b0000000100, … , 10’b1000000000)</p>
<p><strong>Derive state transition and output logic equations by inspection</strong> assuming a one-hot encoding. Implement only the state transition logic and output logic (the combinational logic portion) for this state machine. (The testbench will test with non-one hot inputs to make sure you’re not trying to do something more complicated. See <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm3onehot" title="fsm3onehot">fsm3onehot</a> for a description of what is meant by deriving logic equations “by inspection” for one-hot state machines.)</p>
<p>Write code that generates the following equations:</p>
<ul>
<li>B3_next – next-state logic for state B3</li>
<li>S_next</li>
<li>S1_next</li>
<li>Count_next</li>
<li>Wait_next</li>
<li>done – output logic</li>
<li>counting</li>
<li>shift_ena</li>
</ul>
<p>Logic equations for one-hot state transition logic can be derived by looking at in-edges of the state transition diagram.</p>
<h3 id="Module-Declaration-38"><a href="#Module-Declaration-38" class="headerlink" title="Module Declaration"></a>Module Declaration</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> d,</span><br><span class="line">    <span class="keyword">input</span> done_counting,</span><br><span class="line">    <span class="keyword">input</span> ack,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] state,    <span class="comment">// 10-bit one-hot current state</span></span><br><span class="line">    <span class="keyword">output</span> B3_next,</span><br><span class="line">    <span class="keyword">output</span> S_next,</span><br><span class="line">    <span class="keyword">output</span> S1_next,</span><br><span class="line">    <span class="keyword">output</span> Count_next,</span><br><span class="line">    <span class="keyword">output</span> Wait_next,</span><br><span class="line">    <span class="keyword">output</span> done,</span><br><span class="line">    <span class="keyword">output</span> counting,</span><br><span class="line">    <span class="keyword">output</span> shift_ena</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Solution-25"><a href="#Solution-25" class="headerlink" title="Solution"></a>Solution</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> d,</span><br><span class="line">    <span class="keyword">input</span> done_counting,</span><br><span class="line">    <span class="keyword">input</span> ack,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] state,    <span class="comment">// 10-bit one-hot current state</span></span><br><span class="line">    <span class="keyword">output</span> B3_next,</span><br><span class="line">    <span class="keyword">output</span> S_next,</span><br><span class="line">    <span class="keyword">output</span> S1_next,</span><br><span class="line">    <span class="keyword">output</span> Count_next,</span><br><span class="line">    <span class="keyword">output</span> Wait_next,</span><br><span class="line">    <span class="keyword">output</span> done,</span><br><span class="line">    <span class="keyword">output</span> counting,</span><br><span class="line">    <span class="keyword">output</span> shift_ena</span><br><span class="line">); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// You may use these parameters to access state bits using e.g., state[B2] instead of state[6].</span></span><br><span class="line">    <span class="keyword">parameter</span> S=<span class="number">0</span>, S1=<span class="number">1</span>, S11=<span class="number">2</span>, S110=<span class="number">3</span>, B0=<span class="number">4</span>, B1=<span class="number">5</span>, B2=<span class="number">6</span>, B3=<span class="number">7</span>, Count=<span class="number">8</span>, Wait=<span class="number">9</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> B3_next = state[B2]; </span><br><span class="line">    <span class="keyword">assign</span> S_next =  ((~d) &amp; (state[S110] | state[S] | state[S1])) | (ack &amp; </span><br><span class="line">        state[Wait]);</span><br><span class="line">    <span class="keyword">assign</span> S1_next = d &amp; state[S];</span><br><span class="line">    <span class="keyword">assign</span> Count_next = ((~done_counting) &amp; state[Count]) | state[B3]; </span><br><span class="line">    <span class="keyword">assign</span> Wait_next = ((~ack) &amp; state[Wait]) | (done_counting &amp; state[Count]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> done = state[Wait];</span><br><span class="line">    <span class="keyword">assign</span> counting = state[Count];</span><br><span class="line">    <span class="keyword">assign</span> shift_ena = (state[B0] | state[B1] | state[B2] | state[B3]);</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<h3 id="Debug-10"><a href="#Debug-10" class="headerlink" title="Debug"></a>Debug</h3><p>最开始这里写错了：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> Count_next = ((~done_counting) &amp; state[Count]) | state[B3];</span><br></pre></td></tr></table></figure>

<p>写成了：</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> Count_next = ((~done_counting) &amp; state[Count]);</span><br></pre></td></tr></table></figure>





</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://pengxuanyao.github.io">Xuanyao Peng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://pengxuanyao.github.io/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/">https://pengxuanyao.github.io/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://pengxuanyao.github.io" target="_blank">Xuanyao's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/verilog/">verilog</a><a class="post-meta__tags" href="/tags/FSM-%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/">FSM(有限状态机)</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2023/01/10/K5ZwIitHl2xDTVq.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/06/05/%E3%80%90CAG_SLAM%E3%80%91-07-BA-Part/"><img class="prev-cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">【CAG_SLAM】-07-BA-Part</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/26/%E3%80%90%E6%9C%AD%E8%AE%B0%E3%80%91%E4%BA%94%E6%9C%88%E6%89%80%E6%80%9D/"><img class="next-cover" src="https://s2.loli.net/2023/01/10/3MOlt6XpLWhyrAx.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">【札记】五月所思</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/01/12/%E3%80%90CAG_SLAM%E3%80%91-01-%E6%8E%A7%E5%88%B6%E4%BF%A1%E5%8F%B7/" title="【CAG_SLAM】-01-控制信号"><img class="cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-12</div><div class="title">【CAG_SLAM】-01-控制信号</div></div></a></div><div><a href="/2022/01/05/%E3%80%90CAG_SLAM%E3%80%91-00-%E6%AF%94%E8%BE%83%E6%A0%91/" title="【CAG_SLAM】-00-比较树"><img class="cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-05</div><div class="title">【CAG_SLAM】-00-比较树</div></div></a></div><div><a href="/2022/01/17/%E3%80%90CAG_SLAM%E3%80%91-02-%E9%A1%B9%E7%9B%AE%E6%80%BB%E7%BB%93/" title="【CAG-SLAM】-02-项目总结"><img class="cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-17</div><div class="title">【CAG-SLAM】-02-项目总结</div></div></a></div><div><a href="/2022/02/28/%E3%80%90CAG_SLAM%E3%80%91-03-Padding-Modules/" title="【CAG_SLAM】-03-Padding-Modules"><img class="cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-28</div><div class="title">【CAG_SLAM】-03-Padding-Modules</div></div></a></div><div><a href="/2022/03/17/%E3%80%90CAG_SLAM%E3%80%91-04-%E9%99%A4%E6%B3%95%E5%99%A8/" title="【CAG_SLAM】-04-除法器"><img class="cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-17</div><div class="title">【CAG_SLAM】-04-除法器</div></div></a></div><div><a href="/2022/03/20/%E3%80%90CAG_SLAM%E3%80%91-05-Zero-Padding/" title="【CAG_SLAM】-05-Zero-Padding"><img class="cover" src="https://s2.loli.net/2023/01/10/MhktI1loSdFYmJT.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-20</div><div class="title">【CAG_SLAM】-05-Zero-Padding</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2023/01/11/uxgHFMtiBm1kKcf.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Xuanyao Peng</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">105</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">72</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/PengXuanyao"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">新手学电脑，也请多多指教。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm1"><span class="toc-number">1.</span> <span class="toc-text">Fsm1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question"><span class="toc-number">1.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration"><span class="toc-number">1.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution"><span class="toc-number">1.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm1s"><span class="toc-number">2.</span> <span class="toc-text">Fsm1s</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-1"><span class="toc-number">2.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-1"><span class="toc-number">2.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Answer"><span class="toc-number">2.3.</span> <span class="toc-text">Answer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm2"><span class="toc-number">3.</span> <span class="toc-text">Fsm2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-2"><span class="toc-number">3.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-2"><span class="toc-number">3.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution"><span class="toc-number">3.3.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm2s"><span class="toc-number">4.</span> <span class="toc-text">Fsm2s</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-3"><span class="toc-number">4.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-3"><span class="toc-number">4.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-1"><span class="toc-number">4.3.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm3comb"><span class="toc-number">5.</span> <span class="toc-text">Fsm3comb</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-4"><span class="toc-number">5.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-2"><span class="toc-number">5.2.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm3onehot"><span class="toc-number">6.</span> <span class="toc-text">Fsm3onehot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-5"><span class="toc-number">6.1.</span> <span class="toc-text">question</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#What-does-%E2%80%9Cderive-equations-by-inspection%E2%80%9D-mean"><span class="toc-number">6.1.1.</span> <span class="toc-text">What does “derive equations by inspection” mean?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-4"><span class="toc-number">6.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-3"><span class="toc-number">6.3.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm3"><span class="toc-number">7.</span> <span class="toc-text">Fsm3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-6"><span class="toc-number">7.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-5"><span class="toc-number">7.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#question-7"><span class="toc-number">7.3.</span> <span class="toc-text">question</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm3-1"><span class="toc-number">8.</span> <span class="toc-text">Fsm3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-8"><span class="toc-number">8.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-6"><span class="toc-number">8.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-4"><span class="toc-number">8.3.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm3s"><span class="toc-number">9.</span> <span class="toc-text">Fsm3s</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-9"><span class="toc-number">9.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-7"><span class="toc-number">9.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-5"><span class="toc-number">9.3.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug"><span class="toc-number">9.4.</span> <span class="toc-text">debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-ece241-2013-q4"><span class="toc-number">10.</span> <span class="toc-text">Exams&#x2F;ece241 2013 q4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-10"><span class="toc-number">10.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-8"><span class="toc-number">10.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-6"><span class="toc-number">10.3.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug-1"><span class="toc-number">10.4.</span> <span class="toc-text">debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lemmings1"><span class="toc-number">11.</span> <span class="toc-text">Lemmings1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-11"><span class="toc-number">11.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-9"><span class="toc-number">11.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-7"><span class="toc-number">11.3.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lemmings2"><span class="toc-number">12.</span> <span class="toc-text">Lemmings2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-12"><span class="toc-number">12.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-10"><span class="toc-number">12.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-8"><span class="toc-number">12.3.</span> <span class="toc-text">solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug-2"><span class="toc-number">12.4.</span> <span class="toc-text">debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lemmings3"><span class="toc-number">13.</span> <span class="toc-text">Lemmings3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-13"><span class="toc-number">13.1.</span> <span class="toc-text">question:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-11"><span class="toc-number">13.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#solution-9"><span class="toc-number">13.3.</span> <span class="toc-text">solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lemmings4"><span class="toc-number">14.</span> <span class="toc-text">Lemmings4</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug"><span class="toc-number">14.1.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-onehot"><span class="toc-number">15.</span> <span class="toc-text">Fsm onehot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-14"><span class="toc-number">15.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-12"><span class="toc-number">15.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Write-your-solution-here"><span class="toc-number">15.3.</span> <span class="toc-text">Write your solution here</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug-3"><span class="toc-number">15.4.</span> <span class="toc-text">debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-ps2"><span class="toc-number">16.</span> <span class="toc-text">Fsm ps2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-15"><span class="toc-number">16.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-timing-diagrams-to-explain-the-desired-behaviour"><span class="toc-number">16.2.</span> <span class="toc-text">Some timing diagrams to explain the desired behaviour</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-13"><span class="toc-number">16.3.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-1"><span class="toc-number">16.4.</span> <span class="toc-text">Solution</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E8%BD%AC%E7%A7%BB%E5%9B%BE"><span class="toc-number">16.4.1.</span> <span class="toc-text">状态转移图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">16.4.2.</span> <span class="toc-text">代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-ps2data"><span class="toc-number">17.</span> <span class="toc-text">Fsm ps2data</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#question-16"><span class="toc-number">17.0.1.</span> <span class="toc-text">question</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-14"><span class="toc-number">17.1.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-2"><span class="toc-number">17.2.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-1"><span class="toc-number">17.3.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-serial"><span class="toc-number">18.</span> <span class="toc-text">Fsm serial</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#question-17"><span class="toc-number">18.1.</span> <span class="toc-text">question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-timing-diagrams"><span class="toc-number">18.2.</span> <span class="toc-text">Some timing diagrams</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-15"><span class="toc-number">18.3.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-3"><span class="toc-number">18.4.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-2"><span class="toc-number">18.5.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-serialdata"><span class="toc-number">19.</span> <span class="toc-text">Fsm serialdata</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Qusetion"><span class="toc-number">19.1.</span> <span class="toc-text">Qusetion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-timing-diagrams-1"><span class="toc-number">19.2.</span> <span class="toc-text">Some timing diagrams</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-16"><span class="toc-number">19.3.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-4"><span class="toc-number">19.4.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-serialdp"><span class="toc-number">20.</span> <span class="toc-text">Fsm serialdp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question"><span class="toc-number">20.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Some-timing-diagrams-2"><span class="toc-number">20.2.</span> <span class="toc-text">Some timing diagrams</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E5%A4%96%E8%AF%9D"><span class="toc-number">20.3.</span> <span class="toc-text">题外话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-17"><span class="toc-number">20.4.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-5"><span class="toc-number">20.5.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-3"><span class="toc-number">20.6.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fsm-hdlc"><span class="toc-number">21.</span> <span class="toc-text">Fsm hdlc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-1"><span class="toc-number">21.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-18"><span class="toc-number">21.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Hint"><span class="toc-number">21.3.</span> <span class="toc-text">Hint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-6"><span class="toc-number">21.4.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-4"><span class="toc-number">21.5.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-ece241-2013-q8"><span class="toc-number">22.</span> <span class="toc-text">Exams&#x2F;ece241 2013 q8</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-2"><span class="toc-number">22.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-19"><span class="toc-number">22.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-7"><span class="toc-number">22.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Referrence"><span class="toc-number">22.4.</span> <span class="toc-text">Referrence</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-ece241-2014-q5a"><span class="toc-number">23.</span> <span class="toc-text">Exams&#x2F;ece241 2014 q5a</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-3"><span class="toc-number">23.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-20"><span class="toc-number">23.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-8"><span class="toc-number">23.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-5"><span class="toc-number">23.4.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-ece241-2014-q5b"><span class="toc-number">24.</span> <span class="toc-text">Exams&#x2F;ece241 2014 q5b</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-4"><span class="toc-number">24.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-21"><span class="toc-number">24.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-9"><span class="toc-number">24.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2014-q3fsm"><span class="toc-number">25.</span> <span class="toc-text">Exams&#x2F;2014 q3fsm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-5"><span class="toc-number">25.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-22"><span class="toc-number">25.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-10"><span class="toc-number">25.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-6"><span class="toc-number">25.4.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2014-q3bfsm"><span class="toc-number">26.</span> <span class="toc-text">Exams&#x2F;2014 q3bfsm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-6"><span class="toc-number">26.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-23"><span class="toc-number">26.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-11"><span class="toc-number">26.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2014-q3c"><span class="toc-number">27.</span> <span class="toc-text">Exams&#x2F;2014 q3c</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-7"><span class="toc-number">27.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-24"><span class="toc-number">27.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-12"><span class="toc-number">27.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-m2014-q6b"><span class="toc-number">28.</span> <span class="toc-text">Exams&#x2F;m2014 q6b</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-25"><span class="toc-number">28.1.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-13"><span class="toc-number">28.2.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tips"><span class="toc-number">28.3.</span> <span class="toc-text">Tips</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-m2014-q6c"><span class="toc-number">29.</span> <span class="toc-text">Exams&#x2F;m2014 q6c</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-8"><span class="toc-number">29.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-26"><span class="toc-number">29.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-14"><span class="toc-number">29.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-m2014-q6"><span class="toc-number">30.</span> <span class="toc-text">Exams&#x2F;m2014 q6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-9"><span class="toc-number">30.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-27"><span class="toc-number">30.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-15"><span class="toc-number">30.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2012-q2fsm"><span class="toc-number">31.</span> <span class="toc-text">Exams&#x2F;2012 q2fsm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-10"><span class="toc-number">31.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-28"><span class="toc-number">31.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-16"><span class="toc-number">31.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-7"><span class="toc-number">31.4.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2012-q2b"><span class="toc-number">32.</span> <span class="toc-text">Exams&#x2F;2012 q2b</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-11"><span class="toc-number">32.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-29"><span class="toc-number">32.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-17"><span class="toc-number">32.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2013-q2afsm"><span class="toc-number">33.</span> <span class="toc-text">Exams&#x2F;2013 q2afsm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-12"><span class="toc-number">33.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-30"><span class="toc-number">33.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-18"><span class="toc-number">33.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-2013-q2bfsm"><span class="toc-number">34.</span> <span class="toc-text">Exams&#x2F;2013 q2bfsm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-13"><span class="toc-number">34.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-31"><span class="toc-number">34.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-19"><span class="toc-number">34.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-count1k"><span class="toc-number">35.</span> <span class="toc-text">Exams&#x2F;review2015 count1k</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-14"><span class="toc-number">35.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-32"><span class="toc-number">35.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-20"><span class="toc-number">35.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-shiftcount"><span class="toc-number">36.</span> <span class="toc-text">Exams&#x2F;review2015 shiftcount</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-15"><span class="toc-number">36.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-33"><span class="toc-number">36.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-21"><span class="toc-number">36.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-8"><span class="toc-number">36.4.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-fsmseq"><span class="toc-number">37.</span> <span class="toc-text">Exams&#x2F;review2015 fsmseq</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-16"><span class="toc-number">37.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-34"><span class="toc-number">37.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-22"><span class="toc-number">37.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-fsmshift"><span class="toc-number">38.</span> <span class="toc-text">Exams&#x2F;review2015 fsmshift</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-17"><span class="toc-number">38.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-35"><span class="toc-number">38.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Soltuion"><span class="toc-number">38.3.</span> <span class="toc-text">Soltuion</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-fsm"><span class="toc-number">39.</span> <span class="toc-text">Exams&#x2F;review2015 fsm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-18"><span class="toc-number">39.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-36"><span class="toc-number">39.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-23"><span class="toc-number">39.3.</span> <span class="toc-text">Solution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-fancytimer"><span class="toc-number">40.</span> <span class="toc-text">Exams&#x2F;review2015 fancytimer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-19"><span class="toc-number">40.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-37"><span class="toc-number">40.2.</span> <span class="toc-text">Module Declaration</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Hint-1"><span class="toc-number">40.2.1.</span> <span class="toc-text">Hint</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-24"><span class="toc-number">40.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-9"><span class="toc-number">40.4.</span> <span class="toc-text">Debug</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exams-x2F-review2015-fsmonehot"><span class="toc-number">41.</span> <span class="toc-text">Exams&#x2F;review2015 fsmonehot</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Question-20"><span class="toc-number">41.1.</span> <span class="toc-text">Question</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Module-Declaration-38"><span class="toc-number">41.2.</span> <span class="toc-text">Module Declaration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Solution-25"><span class="toc-number">41.3.</span> <span class="toc-text">Solution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug-10"><span class="toc-number">41.4.</span> <span class="toc-text">Debug</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/01/13/%E3%80%90bkyun%E3%80%9100-%E4%BA%91%E5%B9%B3%E5%8F%B0%E5%9F%B9%E8%AE%AD%E5%92%8CEDA%E4%BD%BF%E7%94%A8/" title="【bkyun】00_云平台培训和EDA使用"><img src="https://www.cloudam.cn/commons/images/v1/Header/logo.svg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【bkyun】00_云平台培训和EDA使用"/></a><div class="content"><a class="title" href="/2023/01/13/%E3%80%90bkyun%E3%80%9100-%E4%BA%91%E5%B9%B3%E5%8F%B0%E5%9F%B9%E8%AE%AD%E5%92%8CEDA%E4%BD%BF%E7%94%A8/" title="【bkyun】00_云平台培训和EDA使用">【bkyun】00_云平台培训和EDA使用</a><time datetime="2023-01-13T02:17:38.000Z" title="发表于 2023-01-13 10:17:38">2023-01-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/12/%E3%80%90Hexo%E3%80%91-06-%E4%BD%BF%E7%94%A8github%E5%90%8C%E6%AD%A5%E5%8D%9A%E5%AE%A2%E6%97%B6%E7%9A%84%E8%8B%A5%E5%B9%B2%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3/" title="【Hexo】-06-使用github同步博客时的若干问题及解决"><img src="https://s2.loli.net/2023/01/10/Gnz3RKpxZOYeulf.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Hexo】-06-使用github同步博客时的若干问题及解决"/></a><div class="content"><a class="title" href="/2023/01/12/%E3%80%90Hexo%E3%80%91-06-%E4%BD%BF%E7%94%A8github%E5%90%8C%E6%AD%A5%E5%8D%9A%E5%AE%A2%E6%97%B6%E7%9A%84%E8%8B%A5%E5%B9%B2%E9%97%AE%E9%A2%98%E5%8F%8A%E8%A7%A3%E5%86%B3/" title="【Hexo】-06-使用github同步博客时的若干问题及解决">【Hexo】-06-使用github同步博客时的若干问题及解决</a><time datetime="2023-01-12T09:56:23.000Z" title="发表于 2023-01-12 17:56:23">2023-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/10/%E3%80%90Fluid%E3%80%9100_Hexo%E4%B8%BB%E9%A2%98Fluid%E9%85%8D%E7%BD%AE/" title="【Fluid】00_Hexo主题Fluid配置"><img src="https://avatars2.githubusercontent.com/t/3419353?s=280&amp;v=4" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Fluid】00_Hexo主题Fluid配置"/></a><div class="content"><a class="title" href="/2023/01/10/%E3%80%90Fluid%E3%80%9100_Hexo%E4%B8%BB%E9%A2%98Fluid%E9%85%8D%E7%BD%AE/" title="【Fluid】00_Hexo主题Fluid配置">【Fluid】00_Hexo主题Fluid配置</a><time datetime="2023-01-10T07:10:00.000Z" title="发表于 2023-01-10 15:10:00">2023-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/18/%E3%80%90ChiselBookByLiang%E3%80%9100_Chisel/" title="【ChiselBookByLiang】00_Chisel"><img src="https://s2.loli.net/2023/01/10/WrvaUEYJ4xioHbm.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【ChiselBookByLiang】00_Chisel"/></a><div class="content"><a class="title" href="/2022/12/18/%E3%80%90ChiselBookByLiang%E3%80%9100_Chisel/" title="【ChiselBookByLiang】00_Chisel">【ChiselBookByLiang】00_Chisel</a><time datetime="2022-12-18T03:36:20.000Z" title="发表于 2022-12-18 11:36:20">2022-12-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/10/%E3%80%90ChiselBookV1%E3%80%9100_Combinational_Circuit/" title="【ChiselBookV1】00_Combinational_Circuit"><img src="https://s2.loli.net/2023/01/10/w6JK7dIO8ijpDg3.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【ChiselBookV1】00_Combinational_Circuit"/></a><div class="content"><a class="title" href="/2022/12/10/%E3%80%90ChiselBookV1%E3%80%9100_Combinational_Circuit/" title="【ChiselBookV1】00_Combinational_Circuit">【ChiselBookV1】00_Combinational_Circuit</a><time datetime="2022-12-10T11:20:20.000Z" title="发表于 2022-12-10 19:20:20">2022-12-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Xuanyao Peng</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">❤️🧡💚🇨🇳💙💜🤎</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>