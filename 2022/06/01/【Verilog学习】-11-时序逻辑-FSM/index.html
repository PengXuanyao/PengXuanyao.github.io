<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="标准的一些三段式有限状态机  Fsm1 question This is a Moore state machine with two states, one input, and one output. Implement this state machine. Notice that the reset state is B. This exercise is the sam">
<meta property="og:type" content="article">
<meta property="og:title" content="【Verilog学习】-11-时序逻辑-FSM">
<meta property="og:url" content="http://example.com/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/index.html">
<meta property="og:site_name" content="PengXuanyao">
<meta property="og:description" content="标准的一些三段式有限状态机  Fsm1 question This is a Moore state machine with two states, one input, and one output. Implement this state machine. Notice that the reset state is B. This exercise is the sam">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/7/70/Fsm1.png">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/b/b8/Fsmjk.png">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/5/5d/Fsmjks.png">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/8/89/Fsm3.png">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/d/de/Lemmings.gif">
<meta property="og:image" content="https://s2.loli.net/2022/06/10/NqhfVP6k8Mj7xB9.png">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/7/70/Lemmings2.gif">
<meta property="og:image" content="https://s2.loli.net/2022/06/10/R1vgx6LzZjTVMfA.png">
<meta property="og:image" content="https://hdlbits.01xz.net/mw/images/a/a2/Lemmings3.gif">
<meta property="og:image" content="https://s2.loli.net/2022/07/06/98CvhMdRqoSIp6F.png">
<meta property="article:published_time" content="2022-06-01T11:42:12.000Z">
<meta property="article:modified_time" content="2022-07-15T13:55:46.060Z">
<meta property="article:author" content="PengXuanyao">
<meta property="article:tag" content="verilog">
<meta property="article:tag" content="FSM(有限状态机)">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hdlbits.01xz.net/mw/images/7/70/Fsm1.png">


<link rel="canonical" href="http://example.com/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/","path":"2022/06/01/【Verilog学习】-11-时序逻辑-FSM/","title":"【Verilog学习】-11-时序逻辑-FSM"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>【Verilog学习】-11-时序逻辑-FSM | PengXuanyao</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">PengXuanyao</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">天地交，万物通</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm1"><span class="nav-number">1.</span> <span class="nav-text">Fsm1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question"><span class="nav-number">1.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration"><span class="nav-number">1.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution"><span class="nav-number">1.3.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm1s"><span class="nav-number">2.</span> <span class="nav-text">Fsm1s</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-1"><span class="nav-number">2.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-1"><span class="nav-number">2.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#answer"><span class="nav-number">2.3.</span> <span class="nav-text">Answer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm2"><span class="nav-number">3.</span> <span class="nav-text">Fsm2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-2"><span class="nav-number">3.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-2"><span class="nav-number">3.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-1"><span class="nav-number">3.3.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm2s"><span class="nav-number">4.</span> <span class="nav-text">Fsm2s</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-3"><span class="nav-number">4.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-3"><span class="nav-number">4.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-2"><span class="nav-number">4.3.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm3comb"><span class="nav-number">5.</span> <span class="nav-text">Fsm3comb</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-4"><span class="nav-number">5.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-3"><span class="nav-number">5.2.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm3onehot"><span class="nav-number">6.</span> <span class="nav-text">Fsm3onehot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-5"><span class="nav-number">6.1.</span> <span class="nav-text">question</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#what-does-derive-equations-by-inspection-mean"><span class="nav-number">6.1.1.</span> <span class="nav-text">What does &quot;derive
equations by inspection&quot; mean?</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-4"><span class="nav-number">6.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-4"><span class="nav-number">6.3.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm3"><span class="nav-number">7.</span> <span class="nav-text">Fsm3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-6"><span class="nav-number">7.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-5"><span class="nav-number">7.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#question-7"><span class="nav-number">7.3.</span> <span class="nav-text">question</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm3-1"><span class="nav-number">8.</span> <span class="nav-text">Fsm3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-8"><span class="nav-number">8.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-6"><span class="nav-number">8.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-5"><span class="nav-number">8.3.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm3s"><span class="nav-number">9.</span> <span class="nav-text">Fsm3s</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-9"><span class="nav-number">9.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-7"><span class="nav-number">9.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-6"><span class="nav-number">9.3.</span> <span class="nav-text">solution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug"><span class="nav-number">9.4.</span> <span class="nav-text">debug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#examsece241-2013-q4"><span class="nav-number">10.</span> <span class="nav-text">Exams&#x2F;ece241 2013 q4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-10"><span class="nav-number">10.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-8"><span class="nav-number">10.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-7"><span class="nav-number">10.3.</span> <span class="nav-text">solution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-1"><span class="nav-number">10.4.</span> <span class="nav-text">debug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lemmings1"><span class="nav-number">11.</span> <span class="nav-text">Lemmings1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-11"><span class="nav-number">11.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-9"><span class="nav-number">11.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-8"><span class="nav-number">11.3.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lemmings2"><span class="nav-number">12.</span> <span class="nav-text">Lemmings2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-12"><span class="nav-number">12.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-10"><span class="nav-number">12.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-9"><span class="nav-number">12.3.</span> <span class="nav-text">solution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-2"><span class="nav-number">12.4.</span> <span class="nav-text">debug</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lemmings3"><span class="nav-number">13.</span> <span class="nav-text">Lemmings3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-13"><span class="nav-number">13.1.</span> <span class="nav-text">question:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-11"><span class="nav-number">13.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#solution-10"><span class="nav-number">13.3.</span> <span class="nav-text">solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fsm-onehot"><span class="nav-number">14.</span> <span class="nav-text">Fsm onehot</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#question-14"><span class="nav-number">14.1.</span> <span class="nav-text">question</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#module-declaration-12"><span class="nav-number">14.2.</span> <span class="nav-text">Module Declaration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#write-your-solution-here"><span class="nav-number">14.3.</span> <span class="nav-text">Write your solution here</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debug-3"><span class="nav-number">14.4.</span> <span class="nav-text">debug</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="PengXuanyao"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">PengXuanyao</p>
  <div class="site-description" itemprop="description">This is my personal blog</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/01/%E3%80%90Verilog%E5%AD%A6%E4%B9%A0%E3%80%91-11-%E6%97%B6%E5%BA%8F%E9%80%BB%E8%BE%91-FSM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="PengXuanyao">
      <meta itemprop="description" content="This is my personal blog">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PengXuanyao">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          【Verilog学习】-11-时序逻辑-FSM
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-01 19:42:12" itemprop="dateCreated datePublished" datetime="2022-06-01T19:42:12+08:00">2022-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-07-15 21:55:46" itemprop="dateModified" datetime="2022-07-15T21:55:46+08:00">2022-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>标准的一些三段式有限状态机</p>
</blockquote>
<h2 id="fsm1">Fsm1</h2>
<h3 id="question">question</h3>
<p>This is a Moore state machine with two states, one input, and one
output. Implement this state machine. Notice that the reset state is
B.</p>
<p>This exercise is the same as <a
target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm1s">fsm1s</a>, but using
asynchronous reset.</p>
<span id="more"></span>
<figure>
<img src="https://hdlbits.01xz.net/mw/images/7/70/Fsm1.png"
alt="Fsm1.png" />
<figcaption aria-hidden="true">Fsm1.png</figcaption>
</figure>
<h3 id="module-declaration">Module Declaration</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">module top_module(</span><br><span class="line">    input clk,</span><br><span class="line">    input areset,    // Asynchronous reset to state B</span><br><span class="line">    input in,</span><br><span class="line">    output out);</span><br></pre></td></tr></table></figure>
<h3 id="solution">Solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to state B</span></span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">output</span> out);<span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">1&#x27;b0</span>, B=<span class="number">1&#x27;b1</span>; </span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span>    <span class="comment">// This is a combinational always block</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A: next_state = in ? A : B;</span><br><span class="line">            B: next_state = in ? B : A;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span>    <span class="comment">// This is a sequential always block</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= B;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            state &lt;= next_state; </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> out = state ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm1s">Fsm1s</h2>
<h3 id="question-1">question</h3>
<p>This is a Moore state machine with two states, one input, and one
output. Implement this state machine. Notice that the reset state is
B.</p>
<p>This exercise is the same as <a
target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm1">fsm1</a>, but using
synchronous reset.</p>
<blockquote>
<p>这道题有点怪，为什么答案是用阻塞赋值</p>
</blockquote>
<h3 id="module-declaration-1">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note the Verilog-1995 module declaration syntax here:</span></span><br><span class="line"><span class="keyword">module</span> top_module(clk, reset, in, out);</span><br><span class="line">    <span class="keyword">input</span> clk;</span><br><span class="line">    <span class="keyword">input</span> reset;    <span class="comment">// Synchronous reset to state B</span></span><br><span class="line">    <span class="keyword">input</span> in;</span><br><span class="line">    <span class="keyword">output</span> out;</span><br></pre></td></tr></table></figure>
<h3 id="answer">Answer</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note the Verilog-1995 module declaration syntax here:</span></span><br><span class="line"><span class="keyword">module</span> top_module(clk, reset, in, out);</span><br><span class="line">    <span class="keyword">input</span> clk;</span><br><span class="line">    <span class="keyword">input</span> reset;    <span class="comment">// Synchronous reset to state B</span></span><br><span class="line">    <span class="keyword">input</span> in;</span><br><span class="line">    <span class="keyword">output</span> out;<span class="comment">//  </span></span><br><span class="line">    <span class="keyword">reg</span> out;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fill in state name declarations</span></span><br><span class="line">    <span class="keyword">parameter</span> A = <span class="number">1&#x27;b0</span>, B = <span class="number">1&#x27;b1</span>;</span><br><span class="line">    <span class="keyword">reg</span> present_state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span>  </span><br><span class="line">            <span class="comment">// Fill in reset logic</span></span><br><span class="line">            present_state = B;</span><br><span class="line">            out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span> (present_state)</span><br><span class="line">                <span class="comment">// Fill in state transition logic</span></span><br><span class="line">                A : next_state = in ? A : B;</span><br><span class="line">                B : next_state = in ? B : A;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// State flip-flops</span></span><br><span class="line">            present_state = next_state;   </span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> (present_state)</span><br><span class="line">                <span class="comment">// Fill in output logic</span></span><br><span class="line">                A : out = <span class="number">1&#x27;b0</span>;</span><br><span class="line">                B : out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm2">Fsm2</h2>
<h3 id="question-2">question</h3>
<p>This is a Moore state machine with two states, two inputs, and one
output. Implement this state machine.</p>
<p>This exercise is the same as <a
target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm2s">fsm2s</a>, but using
asynchronous reset.</p>
<figure>
<img src="https://hdlbits.01xz.net/mw/images/b/b8/Fsmjk.png"
alt="Fsmjk.png" />
<figcaption aria-hidden="true">Fsmjk.png</figcaption>
</figure>
<h3 id="module-declaration-2">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>
<h3 id="solution-1">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> OFF=<span class="number">0</span>, ON=<span class="number">1</span>; </span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            OFF : next_state = j ? ON : OFF;</span><br><span class="line">            ON : next_state = k ? OFF : ON;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= OFF;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == ON);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm2s">Fsm2s</h2>
<h3 id="question-3">question</h3>
<p>This is a Moore state machine with two states, two inputs, and one
output. Implement this state machine.</p>
<p>This exercise is the same as <a
target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/fsm2">fsm2</a>, but using
synchronous reset.</p>
<p><img src="https://hdlbits.01xz.net/mw/images/5/5d/Fsmjks.png" alt="Fsmjks.png"  /></p>
<h3 id="module-declaration-3">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,    <span class="comment">// Synchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>
<h3 id="solution-2">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Asynchronous reset to OFF</span></span><br><span class="line">    <span class="keyword">input</span> j,</span><br><span class="line">    <span class="keyword">input</span> k,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> OFF=<span class="number">0</span>, ON=<span class="number">1</span>; </span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            OFF : next_state = j ? ON : OFF;</span><br><span class="line">            ON : next_state = k ? OFF : ON;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= OFF;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == ON);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm3comb">Fsm3comb</h2>
<h3 id="question-4">question</h3>
<p>The following is the state transition table for a Moore state machine
with one input, one output, and four states. Use the following state
encoding: A=2'b00, B=2'b01, C=2'b10, D=2'b11.</p>
<p><strong>Implement only the state transition logic and output
logic</strong> (the combinational logic portion) for this state machine.
Given the current state (<code>state</code>), compute the
<code>next_state</code> and output (<code>out</code>) based on the state
transition table.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: left;">Next state</th>
<th style="text-align: left;">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">in=0</td>
<td style="text-align: left;">in=1</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">D</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>1</td>
</tr>
</tbody>
</table>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Module Declaration</span><br><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>
<h3 id="solution-3">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">0</span>, B=<span class="number">1</span>, C=<span class="number">2</span>, D=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic: next_state = f(state, in)</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A: next_state = in ? B : A;</span><br><span class="line">            B: next_state = in ? B : C;</span><br><span class="line">            C: next_state = in ? D : A;</span><br><span class="line">            D: next_state = in ? B : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic:  out = f(state) for a Moore state machine</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == D);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm3onehot">Fsm3onehot</h2>
<h3 id="question-5">question</h3>
<p>The following is the state transition table for a Moore state machine
with one input, one output, and four states. Use the following one-hot
state encoding: A=4'b0001, B=4'b0010, C=4'b0100, D=4'b1000.</p>
<p><strong>Derive state transition and output logic equations by
inspection</strong> assuming a one-hot encoding. Implement only the
state transition logic and output logic (the combinational logic
portion) for this state machine. (The testbench will test with non-one
hot inputs to make sure you're not trying to do something more
complicated).</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: left;">Next state</th>
<th style="text-align: left;">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">in=0</td>
<td style="text-align: left;">in=1</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">D</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>1</td>
</tr>
</tbody>
</table>
<blockquote>
<h4 id="what-does-derive-equations-by-inspection-mean">What does "derive
equations by inspection" mean?</h4>
<p>One-hot state machine encoding guarantees that exactly one state bit
is 1. This means that it is possible to determine whether the state
machine is in a particular state by examining only <em>one</em> state
bit, not <em>all</em> state bits. This leads to simple logic equations
for the state transitions by examining the incoming edges for each state
in the state transition diagram.</p>
<p>For example, in the above state machine, how can the state machine
can reach state A? It must use one of the two incoming edges: "Currently
in state A and in=0" or "Currently in state C and in = 0". Due to the
one-hot encoding, the logic equation to test for "currently in state A"
is simply the state bit for state A. This leads to the final logic
equation for the next state of state bit A:
<code>next_state[0] = state[0]&amp;(~in) | state[2]&amp;(~in)</code>.
The one-hot encoding guarantees that at most one clause (product term)
will be "active" at a time, so the clauses can just be ORed
together.</p>
<p>When an exercise asks for state transition equations "by inspection",
use this particular method. The judge will test with non-one-hot inputs
to ensure your logic equations follow this method, rather that doing
something else (such as resetting the FSM) for illegal (non-one-hot)
combinations of the state bits.</p>
<p>Although knowing this algorithm isn't necessary for RTL-level design
(the logic synthesizer handles this), it is illustrative of why one-hot
FSMs often have simpler logic (at the expense of more state bit
storage), and this topic frequently shows up on exams in digital logic
courses.</p>
</blockquote>
<h3 id="module-declaration-4">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out);</span><br></pre></td></tr></table></figure>
<h3 id="solution-4">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">0</span>, B=<span class="number">1</span>, C=<span class="number">2</span>, D=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic: Derive an equation for each state flip-flop.</span></span><br><span class="line">    <span class="keyword">assign</span> next_state[A] = state[A]&amp;(~in) | state[C]&amp;(~in);</span><br><span class="line">    <span class="keyword">assign</span> next_state[B] = state[A]&amp;(in) | state[B]&amp;(in) | state[D]&amp;(in);</span><br><span class="line">    <span class="keyword">assign</span> next_state[C] = state[B]&amp;(~in) | state[D]&amp;(~in);</span><br><span class="line">    <span class="keyword">assign</span> next_state[D] = state[C]&amp;in;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic: </span></span><br><span class="line">    <span class="keyword">assign</span> out = state[D];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm3">Fsm3</h2>
<h3 id="question-6">question</h3>
<p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3comb">State
transition logic for this FSM</a></p>
<p>The following is the state transition table for a Moore state machine
with one input, one output, and four states. Implement this state
machine. Include an asynchronous reset that resets the FSM to state
A.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: left;">Next state</th>
<th style="text-align: left;">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">in=0</td>
<td style="text-align: left;">in=1</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">D</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="module-declaration-5">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>
<h3 id="question-7">question</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm3-1">Fsm3</h2>
<h3 id="question-8">question</h3>
<p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3comb">State
transition logic for this FSM</a></p>
<p>The following is the state transition table for a Moore state machine
with one input, one output, and four states. Implement this state
machine. Include an asynchronous reset that resets the FSM to state
A.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: left;">Next state</th>
<th style="text-align: left;">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">in=0</td>
<td style="text-align: left;">in=1</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">D</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>1</td>
</tr>
</tbody>
</table>
<h3 id="module-declaration-6">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out);</span><br></pre></td></tr></table></figure>
<h3 id="solution-5">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> areset,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] next_state;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line">    <span class="keyword">parameter</span> A=<span class="number">0</span>, B=<span class="number">1</span>, C=<span class="number">2</span>, D=<span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic: next_state = f(state, in)</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A: next_state = in ? B : A;</span><br><span class="line">            B: next_state = in ? B : C;</span><br><span class="line">            C: next_state = in ? D : A;</span><br><span class="line">            D: next_state = in ? B : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) </span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            state &lt;= next_state; </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic:  out = f(state) for a Moore state machine</span></span><br><span class="line">    <span class="keyword">assign</span> out = (state == D);</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* reference */</span></span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">module top_module (</span></span><br><span class="line"><span class="comment">    input clk,</span></span><br><span class="line"><span class="comment">    input in,</span></span><br><span class="line"><span class="comment">    input areset,</span></span><br><span class="line"><span class="comment">    output out</span></span><br><span class="line"><span class="comment">);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Give state names and assignments. I&#x27;m lazy, so I like to use decimal numbers.</span></span><br><span class="line"><span class="comment">    // It doesn&#x27;t really matter what assignment is used, as long as they&#x27;re unique.</span></span><br><span class="line"><span class="comment">    parameter A=0, B=1, C=2, D=3;</span></span><br><span class="line"><span class="comment">    reg [1:0] state;        // Make sure state and next are big enough to hold the state encodings.</span></span><br><span class="line"><span class="comment">    reg [1:0] next;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Combinational always block for state transition logic. Given the current state and inputs,</span></span><br><span class="line"><span class="comment">    // what should be next state be?</span></span><br><span class="line"><span class="comment">    // Combinational always block: Use blocking assignments.    </span></span><br><span class="line"><span class="comment">    always@(*) begin</span></span><br><span class="line"><span class="comment">        case (state)</span></span><br><span class="line"><span class="comment">            A: next = in ? B : A;</span></span><br><span class="line"><span class="comment">            B: next = in ? B : C;</span></span><br><span class="line"><span class="comment">            C: next = in ? D : A;</span></span><br><span class="line"><span class="comment">            D: next = in ? B : C;</span></span><br><span class="line"><span class="comment">        endcase</span></span><br><span class="line"><span class="comment">    end</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Edge-triggered always block (DFFs) for state flip-flops. Asynchronous reset.</span></span><br><span class="line"><span class="comment">    always @(posedge clk, posedge areset) begin</span></span><br><span class="line"><span class="comment">        if (areset) state &lt;= A;</span></span><br><span class="line"><span class="comment">        else state &lt;= next;</span></span><br><span class="line"><span class="comment">    end</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // Combinational output logic. In this problem, an assign statement is the simplest.        </span></span><br><span class="line"><span class="comment">    assign out = (state==D);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">endmodule</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm3s">Fsm3s</h2>
<h3 id="question-9">question</h3>
<p>See also: <a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3comb">State
transition logic for this FSM</a></p>
<p>The following is the state transition table for a Moore state machine
with one input, one output, and four states. Implement this state
machine. Include a synchronous reset that resets the FSM to state A.
(This is the same problem as <a
target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Fsm3">Fsm3</a> but with a
synchronous reset.)</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">State</th>
<th style="text-align: left;">Next state</th>
<th style="text-align: left;">Next state</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">in=0</td>
<td style="text-align: left;">in=1</td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>0</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">A</td>
<td style="text-align: left;">D</td>
<td>0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">D</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">B</td>
<td>1</td>
</tr>
</tbody>
</table>
<figure>
<img src="https://hdlbits.01xz.net/mw/images/8/89/Fsm3.png"
alt="Fsm3.png" />
<figcaption aria-hidden="true">Fsm3.png</figcaption>
</figure>
<h3 id="module-declaration-7">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">output</span> out); </span><br></pre></td></tr></table></figure>
<h3 id="solution-6">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">output</span> out); <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line">    <span class="keyword">parameter</span> A = <span class="number">2&#x27;b00</span>, B = <span class="number">2&#x27;b01</span>, C = <span class="number">2&#x27;b10</span>, D = <span class="number">2&#x27;b11</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state) </span><br><span class="line">            A : next_state = in ? B : A;</span><br><span class="line">            B : next_state = in ? B : C;</span><br><span class="line">            C : next_state = in ? D : A;</span><br><span class="line">            D : next_state = in ? B : C;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// State flip-flops with synchronous reset</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= A;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A : out = <span class="number">0</span>;</span><br><span class="line">            B : out = <span class="number">0</span>;</span><br><span class="line">            C : out = <span class="number">0</span>;</span><br><span class="line">            D : out = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="debug">debug</h3>
<p>开始设置state、next_state的位宽出现了问题：忘记写[1:0]。</p>
<h2 id="examsece241-2013-q4">Exams/ece241 2013 q4</h2>
<h3 id="question-10">question</h3>
<figure>
<embed
src="https://hdlbits.01xz.net/mw/thumb.php?f=Ece241_2013_q4.png&amp;width=740" />
<figcaption aria-hidden="true">Ece241 2013 q4.png</figcaption>
</figure>
<p>Also include an active-high synchronous reset that resets the state
machine to a state equivalent to if the water level had been low for a
long time (no sensors asserted, and all four outputs asserted).</p>
<h3 id="module-declaration-8">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] s,</span><br><span class="line">    <span class="keyword">output</span> fr3,</span><br><span class="line">    <span class="keyword">output</span> fr2,</span><br><span class="line">    <span class="keyword">output</span> fr1,</span><br><span class="line">    <span class="keyword">output</span> dfr</span><br><span class="line">); </span><br></pre></td></tr></table></figure>
<h3 id="solution-7">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] s,</span><br><span class="line">    <span class="keyword">output</span> fr3,</span><br><span class="line">    <span class="keyword">output</span> fr2,</span><br><span class="line">    <span class="keyword">output</span> fr1,</span><br><span class="line">    <span class="keyword">output</span> dfr</span><br><span class="line">); </span><br><span class="line">    <span class="keyword">parameter</span> IDLE = <span class="number">3&#x27;b001</span>, S1_UP = <span class="number">3&#x27;b010</span>, S1_DOWN = <span class="number">3&#x27;b011</span>, S2_UP = <span class="number">3&#x27;b100</span> , S2_DOWN = <span class="number">3&#x27;b101</span>, S3 = <span class="number">3&#x27;b110</span>; </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_UP;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_UP;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = IDLE; <span class="comment">/*开始出现bug是所有的这个位置没加default*/</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S1_UP: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_UP;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S1_UP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S1_DOWN: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_UP;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S1_DOWN;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S2_UP: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_DOWN;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S2_UP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S2_DOWN: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_DOWN;</span><br><span class="line">                    <span class="number">3&#x27;b111</span>: next_state = S3;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S2_DOWN;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            S3: </span><br><span class="line">                <span class="keyword">case</span> (s)</span><br><span class="line">                    <span class="number">3&#x27;b000</span>: next_state = IDLE;</span><br><span class="line">                    <span class="number">3&#x27;b001</span>: next_state = S1_DOWN;</span><br><span class="line">                    <span class="number">3&#x27;b011</span>: next_state = S2_DOWN;</span><br><span class="line">                    <span class="keyword">default</span>: next_state = S3;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">default</span>: next_state = IDLE; <span class="comment">/*开始出现bug是所有case这个位置没加default*/</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= IDLE;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            IDLE: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            S1_UP: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0110</span>;</span><br><span class="line">            S1_DOWN: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0111</span>;</span><br><span class="line">            S2_UP: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">            S2_DOWN: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0011</span>;</span><br><span class="line">            S3: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">default</span>:  &#123;fr3, fr2, fr1, dfr&#125; = &#x27;x;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*reference solution*/</span></span><br><span class="line"><span class="comment">/*参考答案中，next_state的表达式是从状态发生顺序转变的角度考虑，每一个状态只能够转换到相临近的两个状态，上升或者下降*/</span></span><br><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">1</span>] s,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> fr3,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> fr2,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> fr1,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> dfr</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Give state names and assignments. I&#x27;m lazy, so I like to use decimal numbers.</span></span><br><span class="line">    <span class="comment">// It doesn&#x27;t really matter what assignment is used, as long as they&#x27;re unique.</span></span><br><span class="line">    <span class="comment">// We have 6 states here.</span></span><br><span class="line">    <span class="keyword">parameter</span> A2=<span class="number">0</span>, B1=<span class="number">1</span>, B2=<span class="number">2</span>, C1=<span class="number">3</span>, C2=<span class="number">4</span>, D1=<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next;        <span class="comment">// Make sure these are big enough to hold the state encodings.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Edge-triggered always block (DFFs) for state flip-flops. Synchronous reset.    </span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) state &lt;= A2;</span><br><span class="line">        <span class="keyword">else</span> state &lt;= next;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Combinational always block for state transition logic. Given the current state and inputs,</span></span><br><span class="line">    <span class="comment">// what should be next state be?</span></span><br><span class="line">    <span class="comment">// Combinational always block: Use blocking assignments.    </span></span><br><span class="line">    <span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A2: next = s[<span class="number">1</span>] ? B1 : A2;</span><br><span class="line">            B1: next = s[<span class="number">2</span>] ? C1 : (s[<span class="number">1</span>] ? B1 : A2);</span><br><span class="line">            B2: next = s[<span class="number">2</span>] ? C1 : (s[<span class="number">1</span>] ? B2 : A2);</span><br><span class="line">            C1: next = s[<span class="number">3</span>] ? D1 : (s[<span class="number">2</span>] ? C1 : B2);</span><br><span class="line">            C2: next = s[<span class="number">3</span>] ? D1 : (s[<span class="number">2</span>] ? C2 : B2);</span><br><span class="line">            D1: next = s[<span class="number">3</span>] ? D1 : C2;</span><br><span class="line">            <span class="keyword">default</span>: next = &#x27;x;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Combinational output logic. In this problem, a procedural block (combinational always block) </span></span><br><span class="line">    <span class="comment">// is more convenient. Be careful not to create a latch.</span></span><br><span class="line">    <span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line">            A2: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">            B1: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0110</span>;</span><br><span class="line">            B2: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0111</span>;</span><br><span class="line">            C1: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">            C2: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0011</span>;</span><br><span class="line">            D1: &#123;fr3, fr2, fr1, dfr&#125; = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">            <span class="keyword">default</span>: &#123;fr3, fr2, fr1, dfr&#125; = &#x27;x;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="debug-1">debug</h3>
<ul>
<li>注意case要考虑defualt的情况（特别时涉及的不确定输入有多个时，例如3位八种情况，其中3种有效，其他5种（default）也要考虑）</li>
</ul>
<h2 id="lemmings1">Lemmings1</h2>
<h3 id="question-11">question</h3>
<figure>
<img src="https://hdlbits.01xz.net/mw/images/d/de/Lemmings.gif"
alt="File:Lemmings.gif" />
<figcaption aria-hidden="true">File:Lemmings.gif</figcaption>
</figure>
<p>The game <a
target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Lemmings_(video_game)">Lemmings</a>
involves critters with fairly simple brains. So simple that we are going
to model it using a finite state machine.</p>
<p>In the Lemmings' 2D world, Lemmings can be in one of two states:
walking left or walking right. It will switch directions if it hits an
obstacle. In particular, if a Lemming is bumped on the left, it will
walk right. If it's bumped on the right, it will walk left. If it's
bumped on both sides at the same time, it will still switch
directions.</p>
<p>Implement a Moore state machine with two states, two inputs, and one
output that models this behaviour.</p>
<figure>
<img src="https://s2.loli.net/2022/06/10/NqhfVP6k8Mj7xB9.png"
alt="waveform" />
<figcaption aria-hidden="true">waveform</figcaption>
</figure>
<h3 id="module-declaration-9">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right); </span><br></pre></td></tr></table></figure>
<h3 id="solution-8">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right); <span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> LEFT=<span class="number">0</span>, RIGHT=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">reg</span> state, next_state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State transition logic</span></span><br><span class="line">        <span class="keyword">case</span> (state) </span><br><span class="line">            LEFT : next_state = (bump_left) ? RIGHT : LEFT;</span><br><span class="line">            RIGHT : next_state = (bump_right) ? LEFT : RIGHT;</span><br><span class="line">            <span class="keyword">default</span> : next_state = LEFT;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">        <span class="keyword">if</span> (areset == <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= LEFT;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Output logic</span></span><br><span class="line">    <span class="keyword">assign</span> walk_left = (state == LEFT);</span><br><span class="line">    <span class="keyword">assign</span> walk_right = (state == RIGHT);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="lemmings2">Lemmings2</h2>
<h3 id="question-12">question</h3>
<figure>
<img src="https://hdlbits.01xz.net/mw/images/7/70/Lemmings2.gif"
alt="Lemmings2.gif" />
<figcaption aria-hidden="true">Lemmings2.gif</figcaption>
</figure>
<p>See also: <a
target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/Lemmings1">Lemmings1</a>.</p>
<p>In addition to walking left and right, Lemmings will fall (and
presumably go "aaah!") if the ground disappears underneath them.</p>
<p>In addition to walking left and right and changing direction when
bumped, when <code>ground=0</code>, the Lemming will fall and say
"aaah!". When the ground reappears (<code>ground=1</code>), the Lemming
will resume walking in the same direction as before the fall. Being
bumped while falling does not affect the walking direction, and being
bumped in the same cycle as ground disappears (but not yet falling), or
when the ground reappears while still falling, also does not affect the
walking direction.</p>
<p>Build a finite state machine that models this behaviour.</p>
<figure>
<img src="https://s2.loli.net/2022/06/10/R1vgx6LzZjTVMfA.png"
alt="waveform" />
<figcaption aria-hidden="true">waveform</figcaption>
</figure>
<h3 id="module-declaration-10">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah ); </span><br></pre></td></tr></table></figure>
<h3 id="solution-9">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah ); </span><br><span class="line"></span><br><span class="line"><span class="keyword">parameter</span> LEFT = <span class="number">2&#x27;b00</span>, LEFT_FALL = <span class="number">2&#x27;b01</span>, RIGHT = <span class="number">2&#x27;b10</span>, RIGHT_FALL = <span class="number">2&#x27;b11</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line"><span class="comment">// state transition</span></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// State transition logic</span></span><br><span class="line">    <span class="keyword">case</span> (state) </span><br><span class="line">        LEFT : next_state = (!ground) ? LEFT_FALL : (bump_left ? RIGHT : LEFT);</span><br><span class="line">        RIGHT : next_state = (!ground) ? RIGHT_FALL : (bump_right ? LEFT : RIGHT);</span><br><span class="line">        LEFT_FALL : next_state = ground ? LEFT : LEFT_FALL;</span><br><span class="line">        RIGHT_FALL : next_state = ground ? RIGHT : RIGHT_FALL;</span><br><span class="line">        <span class="keyword">default</span> : next_state = LEFT;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// State flip-flops with asynchronous reset</span></span><br><span class="line">    <span class="keyword">if</span> (areset == <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span></span><br><span class="line">        state &lt;= LEFT;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Output logic</span></span><br><span class="line"><span class="keyword">assign</span> walk_left = (state == LEFT);</span><br><span class="line"><span class="keyword">assign</span> walk_right = (state == RIGHT);</span><br><span class="line"><span class="keyword">assign</span> aaah = (state == LEFT_FALL) || (state == RIGHT_FALL);</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="debug-2">debug</h3>
<ul>
<li><code>reg [1:0] state</code>开始写成了<code>reg state</code></li>
<li><code>parameter RIGHT_FALL = 2'b11</code>开始写成了<code>parameter RIGHT_FALL = 2'b10</code></li>
</ul>
<h2 id="lemmings3">Lemmings3</h2>
<h3 id="question-13">question:</h3>
<figure>
<img src="https://hdlbits.01xz.net/mw/images/a/a2/Lemmings3.gif"
alt="Thumbnail for version as of 23:13, 17 November 2015" />
<figcaption aria-hidden="true">Thumbnail for version as of 23:13, 17
November 2015</figcaption>
</figure>
<p>In addition to walking and falling, Lemmings can sometimes be told to
do useful things, like dig (it starts digging when <code>dig=1</code>).
A Lemming can dig if it is currently walking on ground
(<code>ground=1</code> and not falling), and will continue digging until
it reaches the other side (<code>ground=0</code>). At that point, since
there is no ground, it will fall (aaah!), then continue walking in its
original direction once it hits ground again. As with falling, being
bumped while digging has no effect, and being told to dig when falling
or when there is no ground is ignored.</p>
<p>(In other words, a walking Lemming can fall, dig, or switch
directions. If more than one of these conditions are satisfied, fall has
higher precedence than dig, which has higher precedence than switching
directions.)</p>
<p>Extend your finite state machine to model this behaviour.</p>
<figure>
<img src="https://s2.loli.net/2022/07/06/98CvhMdRqoSIp6F.png"
alt="waveform" />
<figcaption aria-hidden="true">waveform</figcaption>
</figure>
<h3 id="module-declaration-11">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">input</span> dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging ); </span><br></pre></td></tr></table></figure>
<h3 id="solution-10">solution</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> areset,    <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span> bump_left,</span><br><span class="line">    <span class="keyword">input</span> bump_right,</span><br><span class="line">    <span class="keyword">input</span> ground,</span><br><span class="line">    <span class="keyword">input</span> dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging ); </span><br><span class="line"></span><br><span class="line"><span class="keyword">localparam</span> LEFT = <span class="number">3&#x27;d0</span>, RIGHT = <span class="number">3&#x27;d1</span>, DIG_R = <span class="number">3&#x27;d2</span>, FALL_R = <span class="number">3&#x27;d3</span>, FALL_L = <span class="number">3&#x27;d4</span></span><br><span class="line">            DLG_L = <span class="number">3&#x27;d5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] next_state;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] current_state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">case</span> (current_state)</span><br><span class="line">        LEFT: </span><br><span class="line">            <span class="keyword">begin</span> </span><br><span class="line">                <span class="keyword">if</span> (ground == <span class="number">1&#x27;b0</span>)</span><br><span class="line">                    next_state = FALL_L;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (dig == <span class="number">1&#x27;b1</span>)</span><br><span class="line">                    next_state = DLG_L;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (bump_left == <span class="number">1&#x27;b1</span> )</span><br><span class="line">                    next_state = RIGHT;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    next_state = current_state;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        RIGHT: </span><br><span class="line">            <span class="keyword">begin</span> </span><br><span class="line">                <span class="keyword">if</span> (ground == <span class="number">1&#x27;b0</span>)</span><br><span class="line">                    next_state = FALL_R;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (dig == <span class="number">1&#x27;b1</span>)</span><br><span class="line">                    next_state = DLG_R;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (bump_left == <span class="number">1&#x27;b1</span> )</span><br><span class="line">                    next_state = LEFT;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    next_state = current_state;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        DIG_L: </span><br><span class="line">            <span class="keyword">begin</span> </span><br><span class="line">                <span class="keyword">if</span> (ground == <span class="number">1&#x27;b0</span>)</span><br><span class="line">                    next_state = FALL_L;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    next_state = current_state;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        DIG_R: </span><br><span class="line">            <span class="keyword">begin</span> </span><br><span class="line">                <span class="keyword">if</span> (ground == <span class="number">1&#x27;b0</span>)</span><br><span class="line">                    next_state = FALL_R;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    next_state = current_state;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        FALL_L:</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground == <span class="number">1&#x27;b1</span>)</span><br><span class="line">                    next_state = LEFT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = current_state;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        FALL_R:</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground == <span class="number">1&#x27;b1</span>) <span class="keyword">begin</span></span><br><span class="line">                    next_state = RIGHT;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = current_state;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!areset) <span class="keyword">begin</span></span><br><span class="line">        current_state &lt;= LEFT;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        current_state &lt;= next_state;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    walk_left = (current_state == walk_left) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    walk_right = (current_state == walk_right) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    aaah = (current_state == FALL_L || current_state == FALL_R) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    digging = (current_state == DIG_R || current_state == DIG_R) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h2 id="fsm-onehot">Fsm onehot</h2>
<h3 id="question-14">question</h3>
<p>Given the following state machine with 1 input and 2 outputs:</p>
<p><a target="_blank" rel="noopener" href="https://hdlbits.01xz.net/wiki/File:Fsmonehot.png"><img
src="https://hdlbits.01xz.net/mw/images/a/a7/Fsmonehot.png"
alt="Fsmonehot.png" /></a></p>
<p>Suppose this state machine uses one-hot encoding, where
<code>state[0]</code> through <code>state[9]</code> correspond to the
states S0 though S9, respectively. The outputs are zero unless otherwise
specified.</p>
<p>Implement the <strong>state transition logic</strong> and
<strong>output logic</strong> portions of the state machine (but not the
state flip-flops). You are given the current state in
<code>state[9:0]</code> and must produce <code>next_state[9:0]</code>
and the two outputs. Derive the logic equations by inspection assuming a
one-hot encoding. (The testbench will test with non-one hot inputs to
make sure you're not trying to do something more complicated).</p>
<h3 id="module-declaration-12">Module Declaration</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out1,</span><br><span class="line">    <span class="keyword">output</span> out2);</span><br></pre></td></tr></table></figure>
<h3 id="write-your-solution-here">Write your solution here</h3>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> in,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">9</span>:<span class="number">0</span>] state,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] next_state,</span><br><span class="line">    <span class="keyword">output</span> out1,</span><br><span class="line">    <span class="keyword">output</span> out2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">    next_state[<span class="number">0</span>] = (~in &amp; (state[<span class="number">0</span>] | state[<span class="number">1</span>] | state[<span class="number">2</span>] | state[<span class="number">3</span>] | state[<span class="number">4</span>]</span><br><span class="line">     | state[<span class="number">7</span>] | state[<span class="number">8</span>] | state[<span class="number">9</span>]));</span><br><span class="line">    next_state[<span class="number">1</span>] = (in &amp; (state[<span class="number">0</span>] | state[<span class="number">8</span>] | state[<span class="number">9</span>]));</span><br><span class="line">    next_state[<span class="number">2</span>] = (in &amp; state[<span class="number">1</span>]);</span><br><span class="line">    next_state[<span class="number">3</span>] = (in &amp; state[<span class="number">2</span>]);</span><br><span class="line">    next_state[<span class="number">4</span>] = (in &amp; state[<span class="number">3</span>]);</span><br><span class="line">    next_state[<span class="number">5</span>] = (in &amp; state[<span class="number">4</span>]);</span><br><span class="line">    next_state[<span class="number">6</span>] = (in &amp; state[<span class="number">5</span>]);</span><br><span class="line">    next_state[<span class="number">7</span>] = (in &amp; (state[<span class="number">7</span>] | state[<span class="number">6</span>]));</span><br><span class="line">    next_state[<span class="number">8</span>] = (~in &amp; state[<span class="number">5</span>]);</span><br><span class="line">    next_state[<span class="number">9</span>] = (~in &amp; state[<span class="number">6</span>]);</span><br><span class="line">    out1 = (state[<span class="number">8</span>] | state[<span class="number">9</span>]);</span><br><span class="line">    out2 = (state[<span class="number">9</span>] | state[<span class="number">7</span>]);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>
<h3 id="debug-3">debug</h3>
<p>这一道题的本意是用独热码的原理进行状态转移，因此如果直接定有状态机进行状态转移，测试会报错。因此，应当选择独热码的转移形式。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/verilog/" rel="tag"># verilog</a>
              <a href="/tags/FSM-%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/" rel="tag"># FSM(有限状态机)</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/26/%E3%80%90%E6%9C%AD%E8%AE%B0%E3%80%91%E4%BA%94%E6%9C%88%E6%89%80%E6%80%9D/" rel="prev" title="【札记】五月所思">
                  <i class="fa fa-chevron-left"></i> 【札记】五月所思
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/06/05/%E3%80%90CAG_SLAM%E3%80%91-07-BA-Part/" rel="next" title="【CAG_SLAM】-07-BA-Part">
                  【CAG_SLAM】-07-BA-Part <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PengXuanyao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
